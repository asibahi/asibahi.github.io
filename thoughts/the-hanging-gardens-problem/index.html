<!doctype html>
<html  dir="ltr" >
	<!-- This site was built using Zola (getzola.com) and heavily edited version of the Hook theme (https://www.getzola.org/themes/hook/) -->

	<head>
		<meta charset="utf-8" />
		<!-- accent color in _theme.scss -->
		<meta name="theme-color" content=" rgb(203, 132, 0)" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta
			name="description"
			content="Exploring the link between Shrödinger&#x27;s Cat and Sudoku"
		/>
		<title>Abdul Rahman Sibahi | The Hanging Gardens Problem</title>
		<link rel="stylesheet" href="https://asibahi.github.io/style.css?h=5e9f4e540307a223aec7" />
	</head>

	<body>
		<a href="https://youtu.be/tXGQPGi-fZw">
			<img src=" /eagle.png" class="eagle" />
		</a>
		<div class="container">
			
	<header class="space">
		<a href="https:&#x2F;&#x2F;asibahi.github.io&#x2F;"> ⏏️ </a>

		
			<h1>The Hanging Gardens Problem</h1>
			
				<p class="secondary">Exploring the link between Shrödinger&#x27;s Cat and Sudoku</p>
			

			<nav>
				
					<p class="secondary">2024-10-17</p>
				 
				<details class="secondary">
					<summary> Contents </summary>
					<ul>
						
						<li>
							<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#problem-formulation">Problem Formulation</a>
							
						</li>
						
						<li>
							<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#wave-function-collapse">Wave Function Collapse</a>
							
						</li>
						
						<li>
							<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#square-gardens">Square Gardens</a>
							
							<ul>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#tiles-and-air">Tiles and Air</a>
								</li>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#grid-and-candidates">Grid and Candidates</a>
								</li>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#propagation">Propagation</a>
								</li>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#controlled-demolition">Controlled Demolition</a>
								</li>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#success-and-failure">Success and Failure</a>
								</li>
								
							</ul>
							
						</li>
						
						<li>
							<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#packed-gardens">Packed Gardens</a>
							
							<ul>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#initialization">Initialization</a>
								</li>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#cube-edges">Cube Edges</a>
								</li>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#propagation-and-controlled-demolition">Propagation and Controlled Demolition</a>
								</li>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#solution-output">Solution Output</a>
								</li>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#faster-iteration-of-visuals">Faster Iteration of Visuals</a>
								</li>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#final-visuals">Final Visuals</a>
								</li>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#producing-an-image">Producing an Image</a>
								</li>
								
							</ul>
							
						</li>
						
						<li>
							<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#hanging-gardens">Hanging Gardens</a>
							
							<ul>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#frankenstein-s-monster">Frankenstein&#x27;s Monster</a>
								</li>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#grid-enhancements">Grid Enhancements</a>
								</li>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#demolition-revision">Demolition Revision</a>
								</li>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#the-main-loop">The Main Loop</a>
								</li>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#the-step-back">The Step Back</a>
								</li>
								
								<li>
									<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#out-of-memory">Out of Memory</a>
								</li>
								
							</ul>
							
						</li>
						
						<li>
							<a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#giving-up-and-lessons-learned">Giving Up and Lessons Learned</a>
							
						</li>
						
					</ul>
				</details>
				
			</nav>
		
	</header>

			
			
	<main><p>This is an interesting puzzle inspired by Christian Freeling's tile set <a href="https://mindsports.nl/index.php/puzzles/3d/394-the-china-cube">The China Cube</a>. As it really has nothing to do with China, I call it <strong>the Hanging Gardens Problem</strong>. Imagine each cube as a section of the Garden, and connections to other cubes are paths and stairways.<sup class="footnote-reference" id="fr-1-1"><a href="#fn-1">1</a></sup></p>
<p>Here is a nice drawing showing the full set of 64 Cubes, from Freeling's site.</p>
<p><img src="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/cubeset.gif" alt="The full set of Cubes" /></p>
<h2 id="problem-formulation">Problem Formulation</h2>
<ul>
<li>There are 64 cubes.</li>
<li>Each cube is unique.</li>
<li>Each cube has a specific number of Red and Blue faces.</li>
<li>Cubes do not rotate or change orientation in anyway.</li>
<li>Direction of the faces is specific: North, East, South, West, Top, Bottom.</li>
</ul>
<p>It follows from these that there is</p>
<ul>
<li>One cube with all Red faces (the Red cube, bottom Cube in the earlier drawing.)</li>
<li>One cube with all Blue faces (the Blue cube, top Cube in the earlier drawing)</li>
<li>Six cubes with one Red face.</li>
<li>Six cubes with one Blue face.</li>
<li>... etc.</li>
</ul>
<p>All possible permutations of Red and Blue faces are represented (hence 64 cubes).</p>
<p>Here is the puzzle: <strong>Assemble the cubes so the Blue faces touch each other, and all the Red faces are exposed.</strong><sup class="footnote-reference" id="fr-2-1"><a href="#fn-2">2</a></sup></p>
<p>In other words, a Blue face must always face, touching, another Blue face. A Red face must not do that. However, a Red face might wave to another Red face from a distance (at least one cube far.)</p>
<p>There is most likely is a solution.</p>
<p>The solution does not have to be one big shape. It actually <em>cannot</em>, because of the Red Cube.</p>
<blockquote>
<p><strong>tl;dr</strong> I gave up on the problem due to time and memory constraints. However, while I was at it, I found solutions to two, equally interesting, sub problems, and nice graphics.</p>
</blockquote>
<h2 id="wave-function-collapse">Wave Function Collapse</h2>
<p>I asked around in a number of Discord servers on how to approach solving the problem programmatically, outside of 3-D printing the set and physically assembling it by hand. The <a href="https://www.gorillasun.de">Gorilla Sun</a> Creative Coding server suggested that using the <a href="https://github.com/mxgmn/WaveFunctionCollapse">Wave Function Collapse</a> algorithm might be the best fit for the problem, and suggested <a href="https://www.youtube.com/watch?v=rI_y2GAlQFM">a very excellent Youtube video from the Coding Train</a> implementing the algorithm in Javascript. It is a <em>very</em> good video that I suggest watching.</p>
<p>As explained at the start of the video, this is simply the Sudoku solving algorithm, generalized to creating random tile sets. Apparently, the Quantum Mechanics inspired name is simply for flavor and searchability.</p>
<p>So, how does one solve a Sudoku?</p>
<ol>
<li>First, identify the connection rules and the tile set. (Which, in Sudoku, need no explaining.)</li>
<li>Second, <em>Observation</em>: mark each empty cell in the grid with the candidate <del>tiles</del> numbers that go in them.</li>
<li>Third, the <em>Collapse</em> in Wave Function Collapse: identify the cells with the fewest number of candidates.
1. Any cell with 1 candidate "collapses" into that candidate, and the number is inked in.
2. <em>If there are not any cells with one candidate</em>, pick one cell with the fewest number of candidates and pick a candidate at random, "collapsing" it.<sup class="footnote-reference" id="fr-3-1"><a href="#fn-3">3</a></sup></li>
<li>Fourth, <em>Propagation</em>: with the new state of things, update the candidates in each call. Here is where Sudoku people use X-wings and Swordfishes and what have you.</li>
<li>Repeat the <em>Collapse</em>, until the grid is full.</li>
<li>If there ever, after Propagation, a cell with <em>zero</em> candidates, this means an illegal state was reached. Either <em>Backtrack</em> to the last random choice, (and, well, choose another branch), or simply start the whole thing over.</li>
</ol>
<p>This approach can work just fine for the Hanging Gardens. The Tile set and the connection rules are clearly defined. It is only a matter of putting it into code and .. running it. The problem most apparent to me, however, is that the search space is potentially <em>huge</em>. So, I first need to try this approach with a smaller problem set.</p>
<hr />
<h2 id="square-gardens">Square Gardens</h2>
<p><img src="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/./transcendental1-3.gif" alt="Garden Squares" /></p>
<p>Phrasing the problem in terms of Squares, and 2D connections, rather than Cubes, shrinks the problem space by an order of magnitude. Plus, <a href="https://www.mindsports.nl/index.php/puzzles/tilings/china-labyrinth/">there is a known solution given by Freeling</a>!</p>
<h3 id="tiles-and-air">Tiles and Air</h3>
<p>First, I need to formulate the tiles. There are two kinds of Tiles. The first kind is the actually Squares. This is a <em>finite</em> set. The second kind, is an "Air" tile. This empty tile is infinitely available, and is automatically placed at the Propagation phase connected to every Red face. A Red face <em>must</em> connect to an Air tile, and a Blue face can <em>never</em> connect to one. An Air tile can connect from any side to any Air tile with no restriction.</p>
<p>I am still having fun with <a href="https://odin-lang.org">Odin</a>, so I will try this solution in it first. Here are the starting types:</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span>Side :: </span><span style="font-weight:bold;color:#a71d5d;">enum</span><span> { North, East, South, West }
</span><span>Tile :: </span><span style="font-weight:bold;color:#a71d5d;">distinct bit_set</span><span>[Side]
</span><span>
</span><span>Air  :: </span><span style="font-weight:bold;color:#a71d5d;">distinct struct</span><span> {}
</span><span>
</span><span>Cell :: </span><span style="font-weight:bold;color:#a71d5d;">union</span><span> { Air, Tile }
</span></code></pre>
<p>I am not too happy about this because while the data can neatly fit into one byte, Odin puts this in two. This looks cleaner and easier to understand than weird hacks, so I will stick to it for the time being. Odin's <code>union</code> is nice here, semantically, as it actually has three states: <code>nil</code>, <code>Air</code> and <code>Tile</code>, exactly as much as needed.</p>
<p>The Squares are only 16 (count them in the image above). It is possible to safely ignore the Red (unconnected) Square, because it can simply be put anywhere in space and does not need to connect to anything. Generating a list of the Squares is as simple as counting to 15, or <code>0xF</code>. Running the below snippet to confirm:</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">main</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> () {
</span><span>    list : [</span><span style="font-weight:bold;color:#a71d5d;">dynamic</span><span>]Cell
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> i </span><span style="font-weight:bold;color:#a71d5d;">in u8</span><span>(</span><span style="color:#0086b3;">0x1</span><span>) ..= </span><span style="color:#0086b3;">0xF</span><span> {
</span><span>        fmt.</span><span style="color:#62a35c;">println</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">transmute</span><span>(Tile)i)
</span><span>        </span><span style="color:#62a35c;">append</span><span>(&amp;list, </span><span style="font-weight:bold;color:#a71d5d;">transmute</span><span>(Tile)i) </span><span style="font-style:italic;color:#969896;">// &lt;-- Odin casting magic here
</span><span>    }
</span><span>
</span><span>    fmt.</span><span style="color:#62a35c;">println</span><span>(</span><span style="color:#62a35c;">len</span><span>(list))
</span><span>}
</span></code></pre>
<p>Prints the following:</p>
<pre style="background-color:#ffffff;color:#323232;"><code><span>Tile{North}
</span><span>Tile{East}
</span><span>Tile{North, East}
</span><span>Tile{South}
</span><span>Tile{North, South}
</span><span>Tile{East, South}
</span><span>Tile{North, East, South}
</span><span>Tile{West}
</span><span>Tile{North, West}
</span><span>Tile{East, West}
</span><span>Tile{North, East, West}
</span><span>Tile{South, West}
</span><span>Tile{North, South, West}
</span><span>Tile{East, South, West}
</span><span>Tile{North, East, South, West}
</span><span>15
</span></code></pre>
<p>Which is exactly what is needed. Hooray!!</p>
<h3 id="grid-and-candidates">Grid and Candidates</h3>
<p>An infinite grid is infeasible due to being in a finite universe and using computers with finite resources. So what is a good size for a finite grid? There are 16 Tiles, so a 16 by 16 grid is a clear upper bound, and clearly too big, due to the impossibility of all squares being in one line. I will go with a 15 by 15 grid, which is also safe as it is too big, but it gives me a nice center cell to fix the Blue square in, and branch everywhere from there.</p>
<p>To track the candidates in each cell, the simplest option, perhaps, is to create a set of tiles. Since each tile corresponds neatly to a number (as per the <code>transmute</code> above,) simply tracking the numbers should be enough. As mentioned also, the Red square can be placed anywhere in space, so it does not need to be tracked. Giving its number, 0, to track the Air Tile should be enough, as it can later replace almost any Air tile in the final grid.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span>Candidates :: </span><span style="font-weight:bold;color:#a71d5d;">distinct bit_set</span><span>[</span><span style="color:#0086b3;">0</span><span>..=</span><span style="color:#0086b3;">15</span><span>; </span><span style="font-weight:bold;color:#a71d5d;">u16</span><span>]
</span><span>
</span><span>Grid :: </span><span style="font-weight:bold;color:#a71d5d;">struct</span><span> {
</span><span>    cells:      [</span><span style="color:#0086b3;">15</span><span>][</span><span style="color:#0086b3;">15</span><span>]Cell, </span><span style="font-style:italic;color:#969896;">// central cell is [7][7]
</span><span>    candidates: [</span><span style="color:#0086b3;">15</span><span>][</span><span style="color:#0086b3;">15</span><span>]Candidates
</span><span>}
</span></code></pre>
<p>Having <code>candidates</code> in a separate field like that is convenient. Any cell with no candidates (a <code>nil</code> bit set), would signal an illegal position reached. Any cell with only one candidate is considered collapsed, and the collapse would then be reflected in the <code>cells</code> field, which represents the actual contents. All this, of course, is subject to be iterated out later.</p>
<p>This is the first draft of how to initialize the grid. Note that in Odin <code>~</code> is the bitwise <code>NOT</code> operator. So <code>~Candidates{15}</code> is the full set <em>except</em> for 15. And <code>~Tile{}</code> is the full set.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">grid_init</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span>() -&gt; (ret: Grid) {
</span><span>    </span><span style="font-style:italic;color:#969896;">// Blue Square
</span><span>    ret.cells[</span><span style="color:#0086b3;">7</span><span>][</span><span style="color:#0086b3;">7</span><span>] = ~Tile{}
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// Fill the Candidates Grid 
</span><span>    ret.candidates = ~Candidates{</span><span style="color:#0086b3;">15</span><span>} </span><span style="font-style:italic;color:#969896;">// broadcast magic
</span><span>    ret.candidates[</span><span style="color:#0086b3;">7</span><span>][</span><span style="color:#0086b3;">7</span><span>] = {</span><span style="color:#0086b3;">15</span><span>}
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return</span><span> ret
</span><span>}
</span></code></pre>
<h3 id="propagation">Propagation</h3>
<p>An astute Sudoku solver would quickly be able to see that this initial list of candidates is, in fact, useless and incorrect. Yes it removes the placed Tile from all candidate positions, but it does <em>not</em> take into account the placed Tile's connections.<sup class="footnote-reference" id="fr-edges-1"><a href="#fn-edges">4</a></sup> For this to work the Candidate grid must be updated to match the new reality.</p>
<p>It follows that for each placed <code>Cell</code> in <code>cells</code>, it must update the surrounding candidates. So a function that gives out the candidates per face is needed. This can almost just be hardcoded, since each number maps neatly to a specific square. It is possible to hardcode it for each tile individually, but where is the fun in that.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span>Candidate_Set :: [Side]Candidates </span><span style="font-style:italic;color:#969896;">// Enumerated arrays, a nice Odin feature.
</span><span>
</span><span style="font-weight:bold;color:#795da3;">tile_connections</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> (c: Cell) -&gt; (ret: Candidate_Set) {
</span><span>    </span><span style="font-style:italic;color:#969896;">// Why not just hardcode it all the way?
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">switch</span><span> t </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> c {
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">case</span><span> Tile: 
</span><span>        ret[.North] = {</span><span style="color:#0086b3;">4</span><span>, </span><span style="color:#0086b3;">5</span><span>,  </span><span style="color:#0086b3;">6</span><span>,  </span><span style="color:#0086b3;">7</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">15</span><span>} </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .North </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t </span><span style="font-weight:bold;color:#a71d5d;">else</span><span> {</span><span style="color:#0086b3;">0</span><span>}
</span><span>        ret[.East]  = {</span><span style="color:#0086b3;">8</span><span>, </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">15</span><span>} </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .East  </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t </span><span style="font-weight:bold;color:#a71d5d;">else</span><span> {</span><span style="color:#0086b3;">0</span><span>}
</span><span>        ret[.South] = {</span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">3</span><span>,  </span><span style="color:#0086b3;">5</span><span>,  </span><span style="color:#0086b3;">7</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">15</span><span>} </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .South </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t </span><span style="font-weight:bold;color:#a71d5d;">else</span><span> {</span><span style="color:#0086b3;">0</span><span>}
</span><span>        ret[.West]  = {</span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span>,  </span><span style="color:#0086b3;">6</span><span>,  </span><span style="color:#0086b3;">7</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">15</span><span>} </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .West  </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t </span><span style="font-weight:bold;color:#a71d5d;">else</span><span> {</span><span style="color:#0086b3;">0</span><span>}
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">case</span><span> Air:
</span><span>        ret[.North] = {</span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span>, </span><span style="color:#0086b3;">8</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>}
</span><span>        ret[.East]  = {</span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span>, </span><span style="color:#0086b3;">4</span><span>,  </span><span style="color:#0086b3;">5</span><span>,  </span><span style="color:#0086b3;">6</span><span>,  </span><span style="color:#0086b3;">7</span><span>}
</span><span>        ret[.South] = {</span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">4</span><span>, </span><span style="color:#0086b3;">6</span><span>, </span><span style="color:#0086b3;">8</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">14</span><span>}
</span><span>        ret[.West]  = {</span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">4</span><span>, </span><span style="color:#0086b3;">5</span><span>, </span><span style="color:#0086b3;">8</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>}
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">case</span><span>: 
</span><span>        ret = ~{}
</span><span>    }
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return
</span><span>}
</span></code></pre>
<p>This is nice, mainly because the <code>Candidates</code> type, being a bit set, can be <code>AND</code>ed together to quickly eliminate candidates from Cells in the relevant direction. This can be run for each new state in a loop (or maybe just twice) to propagate candidates of collapsed <code>Air</code> Cells.</p>
<p>The <code>grid_propagate</code> procedure will have to do a few things. First, it should scan <code>cells</code> for known placements. If there is a known placement, update <code>candidates</code> accordingly. Then scan <code>candidates</code> for any collapsed cells (where there is only one left candidate), and update those in <code>cells</code> accordingly, then repeat. Assertions could be placed if a known placement in <code>cells</code> does not match a collapsed candidates set in <code>candidates</code>. An error would be returned if, during propagation, a <code>candidates</code> cell was found with 0 candidates, indicating an illegal branch reached.</p>
<p>After some trial and error and stack overflows and segmentation faults (due to said stack overflows), I settled on this recursive version It is probably not efficient, as it calculates the same thing multiple times, but it is the most straightforward way i could think of.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">grid_propagate</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> (grid: ^Grid) -&gt; </span><span style="font-weight:bold;color:#a71d5d;">bool</span><span> {
</span><span>    </span><span style="font-style:italic;color:#969896;">// Update candidates based on cells
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">15 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">15</span><span> {
</span><span>        cell := grid.cells[x][y]
</span><span>        tc := </span><span style="color:#62a35c;">tile_connections</span><span>(cell)
</span><span>
</span><span>        </span><span style="font-style:italic;color:#969896;">// North
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> y &lt; </span><span style="color:#0086b3;">14 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x][y + </span><span style="color:#0086b3;">1</span><span>] &amp;= tc[.North]
</span><span>        </span><span style="font-style:italic;color:#969896;">// East
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> x &lt; </span><span style="color:#0086b3;">14 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x + </span><span style="color:#0086b3;">1</span><span>][y] &amp;= tc[.East]
</span><span>        </span><span style="font-style:italic;color:#969896;">// South
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> y &gt;  </span><span style="color:#0086b3;">0 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x][y - </span><span style="color:#0086b3;">1</span><span>] &amp;= tc[.South]
</span><span>        </span><span style="font-style:italic;color:#969896;">// West
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> x &gt;  </span><span style="color:#0086b3;">0 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x - </span><span style="color:#0086b3;">1</span><span>][y] &amp;= tc[.West]
</span><span>
</span><span>        </span><span style="font-style:italic;color:#969896;">// if cell is a tile, make sure it is not a candidate anywhere else.
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> tile, ok := cell.(Tile); ok {
</span><span>            </span><span style="font-style:italic;color:#969896;">// Weird hack
</span><span>            cand := Candidates{ </span><span style="font-weight:bold;color:#a71d5d;">int</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">transmute</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>)tile) }
</span><span>
</span><span>            </span><span style="font-style:italic;color:#969896;">// remove it everywhere with broadcast magic
</span><span>            grid.candidates -= cand
</span><span>
</span><span>            </span><span style="font-style:italic;color:#969896;">// then add it in the appropriate place
</span><span>            grid.candidates[x][y] = cand
</span><span>        }
</span><span>    }
</span><span>
</span><span>    any_collapsed := </span><span style="color:#0086b3;">false
</span><span>    
</span><span>    </span><span style="font-style:italic;color:#969896;">// Update cells based on candidates
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">15 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">15</span><span> {
</span><span>        cand := grid.candidates[x][y]
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> cand == {} </span><span style="font-weight:bold;color:#a71d5d;">do return </span><span style="color:#0086b3;">false </span><span style="font-style:italic;color:#969896;">// illegal state reached
</span><span>                
</span><span>        </span><span style="font-style:italic;color:#969896;">// COLLAPSE
</span><span>        </span><span style="font-style:italic;color:#969896;">// obviously only a new collapse if it is not collapsed already
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> grid.cells[x][y] == </span><span style="color:#0086b3;">nil</span><span> &amp;&amp; </span><span style="color:#62a35c;">card</span><span>(cand) == </span><span style="color:#0086b3;">1 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> id </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> cand {
</span><span>            any_collapsed = </span><span style="color:#0086b3;">true
</span><span>
</span><span>            </span><span style="font-style:italic;color:#969896;">// What did actually collapse
</span><span>            grid.cells[x][y] = Air{} </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> id == </span><span style="color:#0086b3;">0 </span><span style="font-weight:bold;color:#a71d5d;">else transmute</span><span>(Tile)</span><span style="font-weight:bold;color:#a71d5d;">i8</span><span>(id)
</span><span>        }
</span><span>    }
</span><span>
</span><span>    success := </span><span style="color:#0086b3;">true
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> any_collapsed </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> success = </span><span style="color:#62a35c;">grid_propagate</span><span>(grid) </span><span style="font-style:italic;color:#969896;">// recursion!!
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return</span><span> success
</span><span>}
</span></code></pre>
<p>Then just update <code>grid_init</code> like this</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">grid_init</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> () -&gt; (ret: Grid) {
</span><span>    
</span><span>    </span><span style="font-style:italic;color:#969896;">// Fill the Candidates Grid
</span><span>    ret.candidates = ~Candidates{}
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// Place Blue square
</span><span>    ret.cells[</span><span style="color:#0086b3;">7</span><span>][</span><span style="color:#0086b3;">7</span><span>] = ~Tile{}
</span><span>
</span><span>    </span><span style="color:#62a35c;">grid_propagate</span><span>(&amp;ret)
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return</span><span> ret
</span><span>}
</span></code></pre>
<p>And it works, nicely! Place any of the Squares instead of <code>~Tile{}</code>, and it works correctly. Even propagates <code>Air</code> cells and their neighbors!!</p>
<h3 id="controlled-demolition">Controlled Demolition</h3>
<p>The <code>grid_propagate</code> procedure takes of care of collapsing cells with one candidate left. But as soon as right after the initial position, there are still many cells with unresolved state. That's why Controlled Demolition is needed, to <em>force</em> things to collapse, randomly.<sup class="footnote-reference" id="fr-metaphor-1"><a href="#fn-metaphor">5</a></sup></p>
<p>The best candidates for Controlled Demolition are the cells with the least amount of candidates that are not already collapsed. That's to say, the least amount of candidates more than 1. Recording these is probably easy. Choosing one randomly, with even chances all over, is, at first impression, not. It is easy to choose <em>arbitrarily</em>, but not necessarily randomly. If a robust backtracking algorithm exists, then arbitrary is probably better than random. But I do not currently plan to backtrack, but instead simply start over whenever an illegal position is encountered.</p>
<p>How should one go about this? With so much randomness, the probably most straightforward course of action is to randomize the indices 0-14 three times. The first two randomized arrays are to loop over <code>candidates</code> in a somewhat random order. The third one is to loop over the candidates in the final found cell, and collapse to the first one it matches over.</p>
<p>Sounds absolutely <em>boneheaded</em>, but it should work just fine.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">grid_controlled_demolition</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> (grid: ^Grid) -&gt; </span><span style="font-weight:bold;color:#a71d5d;">bool</span><span> {
</span><span>    </span><span style="font-style:italic;color:#969896;">// all the shuffling 
</span><span>    rows := []</span><span style="font-weight:bold;color:#a71d5d;">int</span><span>{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span>, </span><span style="color:#0086b3;">4</span><span>, </span><span style="color:#0086b3;">5</span><span>, </span><span style="color:#0086b3;">6</span><span>, </span><span style="color:#0086b3;">7</span><span>, </span><span style="color:#0086b3;">8</span><span>, </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">14</span><span> }
</span><span>    rand.</span><span style="color:#62a35c;">shuffle</span><span>(rows)
</span><span>    
</span><span>    cols := []</span><span style="font-weight:bold;color:#a71d5d;">int</span><span>{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span>, </span><span style="color:#0086b3;">4</span><span>, </span><span style="color:#0086b3;">5</span><span>, </span><span style="color:#0086b3;">6</span><span>, </span><span style="color:#0086b3;">7</span><span>, </span><span style="color:#0086b3;">8</span><span>, </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">14</span><span> }
</span><span>    rand.</span><span style="color:#62a35c;">shuffle</span><span>(cols)
</span><span>    
</span><span>    ids  := []</span><span style="font-weight:bold;color:#a71d5d;">int</span><span>{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span>, </span><span style="color:#0086b3;">4</span><span>, </span><span style="color:#0086b3;">5</span><span>, </span><span style="color:#0086b3;">6</span><span>, </span><span style="color:#0086b3;">7</span><span>, </span><span style="color:#0086b3;">8</span><span>, </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">14</span><span> }
</span><span>    rand.</span><span style="color:#62a35c;">shuffle</span><span>(ids)
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// target collapse stored here
</span><span>    t_x, t_y: </span><span style="font-weight:bold;color:#a71d5d;">int
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// tracking the minimum
</span><span>    min_card := </span><span style="color:#0086b3;">15
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// loop over the grid &quot;randomly&quot;
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> cols </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> rows {
</span><span>        c := </span><span style="color:#62a35c;">card</span><span>(grid.candidates[x][y])
</span><span>        (c &gt; </span><span style="color:#0086b3;">1</span><span>) </span><span style="font-weight:bold;color:#a71d5d;">or_continue </span><span style="font-style:italic;color:#969896;">// already collapsed
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> c &lt; min_card {
</span><span>            t_x = x
</span><span>            t_y = y
</span><span>            min_card = c
</span><span>        }
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> min_card == </span><span style="color:#0086b3;">2 </span><span style="font-weight:bold;color:#a71d5d;">do break </span><span style="font-style:italic;color:#969896;">// no point in looking further
</span><span>    }
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// loop over the set flags randomly and collapse to the first match.
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> id </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> ids </span><span style="font-weight:bold;color:#a71d5d;">do if</span><span> id </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> grid.candidates[t_x][t_y] {
</span><span>        </span><span style="font-style:italic;color:#969896;">// COLLAPSE
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> id == </span><span style="color:#0086b3;">0</span><span> {
</span><span>            grid.cells[t_x][t_y] = Air{}
</span><span>            grid.candidates[t_x][t_y] = {</span><span style="color:#0086b3;">0</span><span>}
</span><span>        } </span><span style="font-weight:bold;color:#a71d5d;">else</span><span> {
</span><span>            tile := </span><span style="font-weight:bold;color:#a71d5d;">transmute</span><span>(Tile)</span><span style="font-weight:bold;color:#a71d5d;">i8</span><span>(id)
</span><span>            cand := Candidates{ </span><span style="font-weight:bold;color:#a71d5d;">int</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">transmute</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>)tile) }
</span><span>
</span><span>            grid.cells[t_x][t_y] = tile
</span><span>            grid.candidates -= cand
</span><span>            grid.candidates[t_x][t_y] = cand
</span><span>        } 
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">break
</span><span>    }
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// then propagate the new changes, returning the legality result
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return </span><span style="color:#62a35c;">grid_propagate</span><span>(grid)
</span><span>}
</span></code></pre>
<p>This should be enough? Calling <code>grid_controlled_demolition</code> a couple of times seems to produce the expected result.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">main</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> () {
</span><span>    grid := </span><span style="color:#62a35c;">grid_init</span><span>()
</span><span>    
</span><span>    </span><span style="font-style:italic;color:#969896;">// crude 
</span><span>    </span><span style="color:#62a35c;">grid_controlled_demolition</span><span>(&amp;grid)
</span><span>    </span><span style="color:#62a35c;">grid_controlled_demolition</span><span>(&amp;grid)
</span><span>    </span><span style="color:#62a35c;">grid_controlled_demolition</span><span>(&amp;grid)
</span><span>    </span><span style="color:#62a35c;">grid_controlled_demolition</span><span>(&amp;grid)
</span><span>    </span><span style="color:#62a35c;">grid_controlled_demolition</span><span>(&amp;grid)
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> row, ri </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> grid.candidates </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> c, ci </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> row {
</span><span>        fmt.</span><span style="color:#62a35c;">println</span><span>(ri, ci, c)
</span><span>    }
</span><span>}
</span></code></pre>
<details> <summary>Sample output.</summary>
<pre style="background-color:#ffffff;color:#323232;"><code><span>0 0 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>0 1 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>0 2 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>0 3 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>0 4 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>0 5 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>0 6 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>0 7 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>0 8 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>0 9 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>0 10 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>0 11 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>0 12 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>0 13 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>0 14 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>1 0 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>1 1 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>1 2 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>1 3 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>1 4 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>1 5 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>1 6 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>1 7 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>1 8 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>1 9 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>1 10 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>1 11 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>1 12 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>1 13 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>1 14 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>2 0 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>2 1 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>2 2 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>2 3 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>2 4 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>2 5 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>2 6 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>2 7 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>2 8 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>2 9 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>2 10 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>2 11 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>2 12 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>2 13 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>2 14 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>3 0 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>3 1 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>3 2 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>3 3 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>3 4 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>3 5 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>3 6 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>3 7 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>3 8 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>3 9 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>3 10 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>3 11 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>3 12 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>3 13 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>3 14 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>4 0 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>4 1 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>4 2 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>4 3 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>4 4 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>4 5 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>4 6 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>4 7 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>4 8 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>4 9 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>4 10 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>4 11 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>4 12 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>4 13 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>4 14 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>5 0 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>5 1 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>5 2 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>5 3 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>5 4 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>5 5 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>5 6 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>5 7 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>5 8 Candidates{0, 1, 4, 8, 12}
</span><span>5 9 Candidates{2, 3, 7, 10, 11}
</span><span>5 10 Candidates{2, 3, 7, 10, 11}
</span><span>5 11 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>5 12 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>5 13 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>5 14 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>6 0 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>6 1 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>6 2 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>6 3 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>6 4 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>6 5 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>6 6 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>6 7 Candidates{0, 2, 4, 8, 10, 12}
</span><span>6 8 Candidates{0}
</span><span>6 9 Candidates{9}
</span><span>6 10 Candidates{13}
</span><span>6 11 Candidates{4, 7, 12}
</span><span>6 12 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>6 13 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>6 14 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>7 0 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>7 1 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>7 2 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>7 3 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>7 4 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>7 5 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>7 6 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>7 7 Candidates{1, 3, 7, 11}
</span><span>7 8 Candidates{6}
</span><span>7 9 Candidates{0}
</span><span>7 10 Candidates{0}
</span><span>7 11 Candidates{0, 1, 2, 3, 8, 10, 11}
</span><span>7 12 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>7 13 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>7 14 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>8 0 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>8 1 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>8 2 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>8 3 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>8 4 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>8 5 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>8 6 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>8 7 Candidates{1, 3, 7, 11}
</span><span>8 8 Candidates{15}
</span><span>8 9 Candidates{5}
</span><span>8 10 Candidates{4, 7}
</span><span>8 11 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>8 12 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>8 13 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>8 14 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>9 0 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>9 1 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>9 2 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>9 3 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>9 4 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>9 5 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>9 6 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>9 7 Candidates{1, 3, 7, 11}
</span><span>9 8 Candidates{14}
</span><span>9 9 Candidates{0}
</span><span>9 10 Candidates{0, 1, 2, 3, 8, 10, 11}
</span><span>9 11 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>9 12 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>9 13 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>9 14 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>10 0 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>10 1 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>10 2 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>10 3 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>10 4 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>10 5 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>10 6 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>10 7 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>10 8 Candidates{8, 10, 11, 12}
</span><span>10 9 Candidates{0, 1, 2, 3, 4, 7}
</span><span>10 10 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>10 11 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>10 12 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>10 13 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>10 14 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>11 0 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>11 1 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>11 2 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>11 3 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>11 4 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>11 5 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>11 6 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>11 7 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>11 8 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>11 9 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>11 10 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>11 11 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>11 12 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>11 13 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>11 14 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>12 0 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>12 1 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>12 2 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>12 3 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>12 4 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>12 5 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>12 6 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>12 7 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>12 8 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>12 9 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>12 10 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>12 11 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>12 12 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>12 13 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>12 14 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>13 0 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>13 1 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>13 2 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>13 3 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>13 4 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>13 5 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>13 6 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>13 7 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>13 8 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>13 9 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>13 10 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>13 11 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>13 12 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>13 13 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>13 14 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>14 0 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>14 1 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>14 2 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>14 3 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>14 4 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>14 5 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>14 6 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>14 7 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>14 8 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>14 9 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>14 10 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>14 11 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>14 12 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>14 13 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span><span>14 14 Candidates{0, 1, 2, 3, 4, 7, 8, 10, 11, 12}
</span></code></pre>
</details>
<h3 id="success-and-failure">Success and Failure</h3>
<p>This seems to work fine. But it is still missing one thing: it needs to know when to stop. If it is a successful solution, (where every cell has exactly one candidate), then stop and print it out. If it is a failed solution, try again. Thankfully, this could be expressed in a couple of lines, with the assumption that the grid has collapsed completely if the first element in the grid, as unlikely as it is to be reached, equals <code>{0}</code>, an <code>Air</code> cell.:</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">main</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> () {
</span><span>    grid := </span><span style="color:#62a35c;">grid_init</span><span>()
</span><span>
</span><span>    outer: </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> {
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">for </span><span style="color:#62a35c;">grid_controlled_demolition</span><span>(&amp;grid) {
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> grid.candidates[</span><span style="color:#0086b3;">0</span><span>][</span><span style="color:#0086b3;">0</span><span>] == {</span><span style="color:#0086b3;">0</span><span>} </span><span style="font-weight:bold;color:#a71d5d;">do break</span><span> outer
</span><span>        }
</span><span>
</span><span>        grid = </span><span style="color:#62a35c;">grid_init</span><span>()
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#62a35c;">grid_print</span><span>(&amp;grid) </span><span style="font-style:italic;color:#969896;">// uninteresting code. it is a grid.
</span><span>}
</span></code></pre>
<p>Here are two sample results, which appear to be correct. The second result is interesting as it has a floating element. Obviously the code is undeterministic: each time it runs it gives a different result.<sup class="footnote-reference" id="fr-symmetric-1"><a href="#fn-symmetric">6</a></sup></p>
<pre style="background-color:#ffffff;color:#323232;"><code><span>// try 1
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |02|  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |03|07|12|  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |11|14|  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |09|15|04|  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |10|  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |01|05|13|06|  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |08|  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>
</span><span>// try 2
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |01|06|  |02|  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |10|  |08|  |  |  |  |  |
</span><span>|  |  |  |  |  |  |03|14|  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |11|15|07|05|04|  |  |  |  |
</span><span>|  |  |  |  |  |  |09|13|12|  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span><span>|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
</span></code></pre>
<p>3D Cubes here I come!!</p>
<hr />
<h2 id="packed-gardens">Packed Gardens</h2>
<p>As the solution for the Square Gardens works, it is obvious that simply changing the data structures and the hardcoded values would solve the 3D solution. I will get to that, but first, I want to try a Packed solution first.</p>
<p>The Packed solution has a much simpler to state goal: Pack all 64 cubes into a 4x4x4 cube. Obviously, in this version, the Red faces can (actually have to) face each other. <em>Only</em> Red faces are allowed to face outside. In his <a href="https://mindsports.nl/index.php/puzzles/3d/394-the-china-cube">page about the set</a>, Freeling does actually provide one Packed solution, with a caveat.</p>
<p><img src="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/chinacube_sol1_2d_466x466.gif" alt="Packed solution for the Cube Gardens" /></p>
<p>The caveat here is that the Red Cube must be contained inside, and not on the edge. It <em>is</em> a difficult requirement, but the provided solution achieves it, at the cost of another floating group at the bottom left of the image above.</p>
<h3 id="initialization">Initialization</h3>
<p>Nonetheless, as it is only a 4x4x4 cube, the search space for the solution is much smaller. There are <em>no</em> <code>Air</code> tiles in here: it is packed. Adding the additional requirement of the Red Cube being wholly contained actually simplifies the solution's initialization. Start the Blue cube at <code>(1,1,1)</code> coordinates, and the Red cube at <code>(2,2,2)</code> coordinates. Any other placement of the two Cubes would actually be a mirror image, or a rotation, of this specific arrangement.</p>
<p>Here are the types, which, for the most part, are shared between the Packed Gardens and the Hanging Gardens, and the initialization function as described.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span>Side :: </span><span style="font-weight:bold;color:#a71d5d;">enum u8</span><span> { North, East, South, West, Top, Bottom }
</span><span>Tile :: </span><span style="font-weight:bold;color:#a71d5d;">distinct bit_set</span><span>[Side; </span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>]
</span><span>
</span><span>Cell :: </span><span style="color:#62a35c;">Maybe</span><span>(Tile)
</span><span>Candidates :: </span><span style="font-weight:bold;color:#a71d5d;">distinct bit_set</span><span>[</span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">64</span><span>; </span><span style="font-weight:bold;color:#a71d5d;">u64</span><span>]
</span><span>
</span><span>Grid :: </span><span style="font-weight:bold;color:#a71d5d;">struct</span><span> {
</span><span>    cells:      [</span><span style="color:#0086b3;">4</span><span>][</span><span style="color:#0086b3;">4</span><span>][</span><span style="color:#0086b3;">4</span><span>]Cell,
</span><span>    candidates: [</span><span style="color:#0086b3;">4</span><span>][</span><span style="color:#0086b3;">4</span><span>][</span><span style="color:#0086b3;">4</span><span>]Candidates,
</span><span>}
</span><span>
</span><span>Candidate_Set :: [Side]Candidates
</span><span>
</span><span style="font-weight:bold;color:#795da3;">grid_init</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> () -&gt; (ret: Grid) {
</span><span>    </span><span style="font-style:italic;color:#969896;">// Fill the candidate Grid
</span><span>    ret.candidates = ~Candidates{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">63</span><span> }
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// Place Blue and Red cubes respectively
</span><span>    ret.cells[</span><span style="color:#0086b3;">1</span><span>][</span><span style="color:#0086b3;">1</span><span>][</span><span style="color:#0086b3;">1</span><span>] = ~Tile{}
</span><span>    ret.cells[</span><span style="color:#0086b3;">2</span><span>][</span><span style="color:#0086b3;">2</span><span>][</span><span style="color:#0086b3;">2</span><span>] = Tile{}
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// Placeholder for now
</span><span>    </span><span style="color:#62a35c;">grid_propagate</span><span>(&amp;ret)
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return 
</span><span>}
</span><span>
</span></code></pre>
<h3 id="cube-edges">Cube Edges</h3>
<p>Unlike in the Square Gardens, this is not enough. While the candidates for the edges were safely ignored there, (as the the solution is unlikely to reach them), they must be encoded here, because they are integral. Time to hardcode the implementation! This is how the values are generated:</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">generate_consts</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> () {
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> side </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> (~Tile{}) {
</span><span>        fmt.</span><span style="color:#62a35c;">printf</span><span>(</span><span style="color:#183691;">&quot;%v_CONNECTED :: Candidates{{&quot;</span><span>, side)
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> i </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">64</span><span> {
</span><span>            tile := </span><span style="font-weight:bold;color:#a71d5d;">transmute</span><span>(Tile)</span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>(i)
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> side </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> fmt.</span><span style="color:#62a35c;">print</span><span>(i, </span><span style="color:#183691;">&quot;,&quot;</span><span>)
</span><span>        }
</span><span>        fmt.</span><span style="color:#62a35c;">println</span><span>(</span><span style="color:#183691;">&quot;}&quot;</span><span>)
</span><span>        fmt.</span><span style="color:#62a35c;">printf</span><span>(</span><span style="color:#183691;">&quot;%v_NOT_CONNECTED :: Candidates{{&quot;</span><span>, side)
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> i </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">64</span><span> {
</span><span>            tile := </span><span style="font-weight:bold;color:#a71d5d;">transmute</span><span>(Tile)</span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>(i)
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> side </span><span style="font-weight:bold;color:#a71d5d;">not_in</span><span> tile </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> fmt.</span><span style="color:#62a35c;">print</span><span>(i, </span><span style="color:#183691;">&quot;,&quot;</span><span>)
</span><span>        }
</span><span>        fmt.</span><span style="color:#62a35c;">println</span><span>(</span><span style="color:#183691;">&quot;}&quot;</span><span>)
</span><span>    }    
</span><span>}
</span></code></pre>
<p>And this is the generated code (with light formatting editing). I have <em>no</em> idea if it is correct. The proof of the pudding is in the eating.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span>NORTH_CONNECTED  :: Candidates{ </span><span style="color:#0086b3;">1</span><span>,  </span><span style="color:#0086b3;">3</span><span>,  </span><span style="color:#0086b3;">5</span><span>,  </span><span style="color:#0086b3;">7</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">15</span><span>, </span><span style="color:#0086b3;">17</span><span>, </span><span style="color:#0086b3;">19</span><span>, </span><span style="color:#0086b3;">21</span><span>, </span><span style="color:#0086b3;">23</span><span>, </span><span style="color:#0086b3;">25</span><span>, </span><span style="color:#0086b3;">27</span><span>, </span><span style="color:#0086b3;">29</span><span>, </span><span style="color:#0086b3;">31</span><span>, </span><span style="color:#0086b3;">33</span><span>, </span><span style="color:#0086b3;">35</span><span>, </span><span style="color:#0086b3;">37</span><span>, </span><span style="color:#0086b3;">39</span><span>, </span><span style="color:#0086b3;">41</span><span>, </span><span style="color:#0086b3;">43</span><span>, </span><span style="color:#0086b3;">45</span><span>, </span><span style="color:#0086b3;">47</span><span>, </span><span style="color:#0086b3;">49</span><span>, </span><span style="color:#0086b3;">51</span><span>, </span><span style="color:#0086b3;">53</span><span>, </span><span style="color:#0086b3;">55</span><span>, </span><span style="color:#0086b3;">57</span><span>, </span><span style="color:#0086b3;">59</span><span>, </span><span style="color:#0086b3;">61</span><span>, </span><span style="color:#0086b3;">63</span><span> }
</span><span>EAST_CONNECTED   :: Candidates{ </span><span style="color:#0086b3;">2</span><span>,  </span><span style="color:#0086b3;">3</span><span>,  </span><span style="color:#0086b3;">6</span><span>,  </span><span style="color:#0086b3;">7</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">15</span><span>, </span><span style="color:#0086b3;">18</span><span>, </span><span style="color:#0086b3;">19</span><span>, </span><span style="color:#0086b3;">22</span><span>, </span><span style="color:#0086b3;">23</span><span>, </span><span style="color:#0086b3;">26</span><span>, </span><span style="color:#0086b3;">27</span><span>, </span><span style="color:#0086b3;">30</span><span>, </span><span style="color:#0086b3;">31</span><span>, </span><span style="color:#0086b3;">34</span><span>, </span><span style="color:#0086b3;">35</span><span>, </span><span style="color:#0086b3;">38</span><span>, </span><span style="color:#0086b3;">39</span><span>, </span><span style="color:#0086b3;">42</span><span>, </span><span style="color:#0086b3;">43</span><span>, </span><span style="color:#0086b3;">46</span><span>, </span><span style="color:#0086b3;">47</span><span>, </span><span style="color:#0086b3;">50</span><span>, </span><span style="color:#0086b3;">51</span><span>, </span><span style="color:#0086b3;">54</span><span>, </span><span style="color:#0086b3;">55</span><span>, </span><span style="color:#0086b3;">58</span><span>, </span><span style="color:#0086b3;">59</span><span>, </span><span style="color:#0086b3;">62</span><span>, </span><span style="color:#0086b3;">63</span><span> }
</span><span>SOUTH_CONNECTED  :: Candidates{ </span><span style="color:#0086b3;">4</span><span>,  </span><span style="color:#0086b3;">5</span><span>,  </span><span style="color:#0086b3;">6</span><span>,  </span><span style="color:#0086b3;">7</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">15</span><span>, </span><span style="color:#0086b3;">20</span><span>, </span><span style="color:#0086b3;">21</span><span>, </span><span style="color:#0086b3;">22</span><span>, </span><span style="color:#0086b3;">23</span><span>, </span><span style="color:#0086b3;">28</span><span>, </span><span style="color:#0086b3;">29</span><span>, </span><span style="color:#0086b3;">30</span><span>, </span><span style="color:#0086b3;">31</span><span>, </span><span style="color:#0086b3;">36</span><span>, </span><span style="color:#0086b3;">37</span><span>, </span><span style="color:#0086b3;">38</span><span>, </span><span style="color:#0086b3;">39</span><span>, </span><span style="color:#0086b3;">44</span><span>, </span><span style="color:#0086b3;">45</span><span>, </span><span style="color:#0086b3;">46</span><span>, </span><span style="color:#0086b3;">47</span><span>, </span><span style="color:#0086b3;">52</span><span>, </span><span style="color:#0086b3;">53</span><span>, </span><span style="color:#0086b3;">54</span><span>, </span><span style="color:#0086b3;">55</span><span>, </span><span style="color:#0086b3;">60</span><span>, </span><span style="color:#0086b3;">61</span><span>, </span><span style="color:#0086b3;">62</span><span>, </span><span style="color:#0086b3;">63</span><span> }
</span><span>WEST_CONNECTED   :: Candidates{ </span><span style="color:#0086b3;">8</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">15</span><span>, </span><span style="color:#0086b3;">24</span><span>, </span><span style="color:#0086b3;">25</span><span>, </span><span style="color:#0086b3;">26</span><span>, </span><span style="color:#0086b3;">27</span><span>, </span><span style="color:#0086b3;">28</span><span>, </span><span style="color:#0086b3;">29</span><span>, </span><span style="color:#0086b3;">30</span><span>, </span><span style="color:#0086b3;">31</span><span>, </span><span style="color:#0086b3;">40</span><span>, </span><span style="color:#0086b3;">41</span><span>, </span><span style="color:#0086b3;">42</span><span>, </span><span style="color:#0086b3;">43</span><span>, </span><span style="color:#0086b3;">44</span><span>, </span><span style="color:#0086b3;">45</span><span>, </span><span style="color:#0086b3;">46</span><span>, </span><span style="color:#0086b3;">47</span><span>, </span><span style="color:#0086b3;">56</span><span>, </span><span style="color:#0086b3;">57</span><span>, </span><span style="color:#0086b3;">58</span><span>, </span><span style="color:#0086b3;">59</span><span>, </span><span style="color:#0086b3;">60</span><span>, </span><span style="color:#0086b3;">61</span><span>, </span><span style="color:#0086b3;">62</span><span>, </span><span style="color:#0086b3;">63</span><span> }
</span><span>TOP_CONNECTED    :: Candidates{</span><span style="color:#0086b3;">16</span><span>, </span><span style="color:#0086b3;">17</span><span>, </span><span style="color:#0086b3;">18</span><span>, </span><span style="color:#0086b3;">19</span><span>, </span><span style="color:#0086b3;">20</span><span>, </span><span style="color:#0086b3;">21</span><span>, </span><span style="color:#0086b3;">22</span><span>, </span><span style="color:#0086b3;">23</span><span>, </span><span style="color:#0086b3;">24</span><span>, </span><span style="color:#0086b3;">25</span><span>, </span><span style="color:#0086b3;">26</span><span>, </span><span style="color:#0086b3;">27</span><span>, </span><span style="color:#0086b3;">28</span><span>, </span><span style="color:#0086b3;">29</span><span>, </span><span style="color:#0086b3;">30</span><span>, </span><span style="color:#0086b3;">31</span><span>, </span><span style="color:#0086b3;">48</span><span>, </span><span style="color:#0086b3;">49</span><span>, </span><span style="color:#0086b3;">50</span><span>, </span><span style="color:#0086b3;">51</span><span>, </span><span style="color:#0086b3;">52</span><span>, </span><span style="color:#0086b3;">53</span><span>, </span><span style="color:#0086b3;">54</span><span>, </span><span style="color:#0086b3;">55</span><span>, </span><span style="color:#0086b3;">56</span><span>, </span><span style="color:#0086b3;">57</span><span>, </span><span style="color:#0086b3;">58</span><span>, </span><span style="color:#0086b3;">59</span><span>, </span><span style="color:#0086b3;">60</span><span>, </span><span style="color:#0086b3;">61</span><span>, </span><span style="color:#0086b3;">62</span><span>, </span><span style="color:#0086b3;">63</span><span> }
</span><span>BOTTOM_CONNECTED :: Candidates{</span><span style="color:#0086b3;">32</span><span>, </span><span style="color:#0086b3;">33</span><span>, </span><span style="color:#0086b3;">34</span><span>, </span><span style="color:#0086b3;">35</span><span>, </span><span style="color:#0086b3;">36</span><span>, </span><span style="color:#0086b3;">37</span><span>, </span><span style="color:#0086b3;">38</span><span>, </span><span style="color:#0086b3;">39</span><span>, </span><span style="color:#0086b3;">40</span><span>, </span><span style="color:#0086b3;">41</span><span>, </span><span style="color:#0086b3;">42</span><span>, </span><span style="color:#0086b3;">43</span><span>, </span><span style="color:#0086b3;">44</span><span>, </span><span style="color:#0086b3;">45</span><span>, </span><span style="color:#0086b3;">46</span><span>, </span><span style="color:#0086b3;">47</span><span>, </span><span style="color:#0086b3;">48</span><span>, </span><span style="color:#0086b3;">49</span><span>, </span><span style="color:#0086b3;">50</span><span>, </span><span style="color:#0086b3;">51</span><span>, </span><span style="color:#0086b3;">52</span><span>, </span><span style="color:#0086b3;">53</span><span>, </span><span style="color:#0086b3;">54</span><span>, </span><span style="color:#0086b3;">55</span><span>, </span><span style="color:#0086b3;">56</span><span>, </span><span style="color:#0086b3;">57</span><span>, </span><span style="color:#0086b3;">58</span><span>, </span><span style="color:#0086b3;">59</span><span>, </span><span style="color:#0086b3;">60</span><span>, </span><span style="color:#0086b3;">61</span><span>, </span><span style="color:#0086b3;">62</span><span>, </span><span style="color:#0086b3;">63</span><span> }
</span><span>
</span><span>NORTH_NOT_CONNECTED  :: Candidates{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">4</span><span>, </span><span style="color:#0086b3;">6</span><span>, </span><span style="color:#0086b3;">8</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">16</span><span>, </span><span style="color:#0086b3;">18</span><span>, </span><span style="color:#0086b3;">20</span><span>, </span><span style="color:#0086b3;">22</span><span>, </span><span style="color:#0086b3;">24</span><span>, </span><span style="color:#0086b3;">26</span><span>, </span><span style="color:#0086b3;">28</span><span>, </span><span style="color:#0086b3;">30</span><span>, </span><span style="color:#0086b3;">32</span><span>, </span><span style="color:#0086b3;">34</span><span>, </span><span style="color:#0086b3;">36</span><span>, </span><span style="color:#0086b3;">38</span><span>, </span><span style="color:#0086b3;">40</span><span>, </span><span style="color:#0086b3;">42</span><span>, </span><span style="color:#0086b3;">44</span><span>, </span><span style="color:#0086b3;">46</span><span>, </span><span style="color:#0086b3;">48</span><span>, </span><span style="color:#0086b3;">50</span><span>, </span><span style="color:#0086b3;">52</span><span>, </span><span style="color:#0086b3;">54</span><span>, </span><span style="color:#0086b3;">56</span><span>, </span><span style="color:#0086b3;">58</span><span>, </span><span style="color:#0086b3;">60</span><span>, </span><span style="color:#0086b3;">62</span><span> }
</span><span>EAST_NOT_CONNECTED   :: Candidates{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">4</span><span>, </span><span style="color:#0086b3;">5</span><span>, </span><span style="color:#0086b3;">8</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">16</span><span>, </span><span style="color:#0086b3;">17</span><span>, </span><span style="color:#0086b3;">20</span><span>, </span><span style="color:#0086b3;">21</span><span>, </span><span style="color:#0086b3;">24</span><span>, </span><span style="color:#0086b3;">25</span><span>, </span><span style="color:#0086b3;">28</span><span>, </span><span style="color:#0086b3;">29</span><span>, </span><span style="color:#0086b3;">32</span><span>, </span><span style="color:#0086b3;">33</span><span>, </span><span style="color:#0086b3;">36</span><span>, </span><span style="color:#0086b3;">37</span><span>, </span><span style="color:#0086b3;">40</span><span>, </span><span style="color:#0086b3;">41</span><span>, </span><span style="color:#0086b3;">44</span><span>, </span><span style="color:#0086b3;">45</span><span>, </span><span style="color:#0086b3;">48</span><span>, </span><span style="color:#0086b3;">49</span><span>, </span><span style="color:#0086b3;">52</span><span>, </span><span style="color:#0086b3;">53</span><span>, </span><span style="color:#0086b3;">56</span><span>, </span><span style="color:#0086b3;">57</span><span>, </span><span style="color:#0086b3;">60</span><span>, </span><span style="color:#0086b3;">61</span><span> }
</span><span>SOUTH_NOT_CONNECTED  :: Candidates{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span>, </span><span style="color:#0086b3;">8</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">16</span><span>, </span><span style="color:#0086b3;">17</span><span>, </span><span style="color:#0086b3;">18</span><span>, </span><span style="color:#0086b3;">19</span><span>, </span><span style="color:#0086b3;">24</span><span>, </span><span style="color:#0086b3;">25</span><span>, </span><span style="color:#0086b3;">26</span><span>, </span><span style="color:#0086b3;">27</span><span>, </span><span style="color:#0086b3;">32</span><span>, </span><span style="color:#0086b3;">33</span><span>, </span><span style="color:#0086b3;">34</span><span>, </span><span style="color:#0086b3;">35</span><span>, </span><span style="color:#0086b3;">40</span><span>, </span><span style="color:#0086b3;">41</span><span>, </span><span style="color:#0086b3;">42</span><span>, </span><span style="color:#0086b3;">43</span><span>, </span><span style="color:#0086b3;">48</span><span>, </span><span style="color:#0086b3;">49</span><span>, </span><span style="color:#0086b3;">50</span><span>, </span><span style="color:#0086b3;">51</span><span>, </span><span style="color:#0086b3;">56</span><span>, </span><span style="color:#0086b3;">57</span><span>, </span><span style="color:#0086b3;">58</span><span>, </span><span style="color:#0086b3;">59</span><span> }
</span><span>WEST_NOT_CONNECTED   :: Candidates{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span>, </span><span style="color:#0086b3;">4</span><span>,  </span><span style="color:#0086b3;">5</span><span>,  </span><span style="color:#0086b3;">6</span><span>,  </span><span style="color:#0086b3;">7</span><span>, </span><span style="color:#0086b3;">16</span><span>, </span><span style="color:#0086b3;">17</span><span>, </span><span style="color:#0086b3;">18</span><span>, </span><span style="color:#0086b3;">19</span><span>, </span><span style="color:#0086b3;">20</span><span>, </span><span style="color:#0086b3;">21</span><span>, </span><span style="color:#0086b3;">22</span><span>, </span><span style="color:#0086b3;">23</span><span>, </span><span style="color:#0086b3;">32</span><span>, </span><span style="color:#0086b3;">33</span><span>, </span><span style="color:#0086b3;">34</span><span>, </span><span style="color:#0086b3;">35</span><span>, </span><span style="color:#0086b3;">36</span><span>, </span><span style="color:#0086b3;">37</span><span>, </span><span style="color:#0086b3;">38</span><span>, </span><span style="color:#0086b3;">39</span><span>, </span><span style="color:#0086b3;">48</span><span>, </span><span style="color:#0086b3;">49</span><span>, </span><span style="color:#0086b3;">50</span><span>, </span><span style="color:#0086b3;">51</span><span>, </span><span style="color:#0086b3;">52</span><span>, </span><span style="color:#0086b3;">53</span><span>, </span><span style="color:#0086b3;">54</span><span>, </span><span style="color:#0086b3;">55</span><span> }
</span><span>TOP_NOT_CONNECTED    :: Candidates{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span>, </span><span style="color:#0086b3;">4</span><span>,  </span><span style="color:#0086b3;">5</span><span>,  </span><span style="color:#0086b3;">6</span><span>,  </span><span style="color:#0086b3;">7</span><span>,  </span><span style="color:#0086b3;">8</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">15</span><span>, </span><span style="color:#0086b3;">32</span><span>, </span><span style="color:#0086b3;">33</span><span>, </span><span style="color:#0086b3;">34</span><span>, </span><span style="color:#0086b3;">35</span><span>, </span><span style="color:#0086b3;">36</span><span>, </span><span style="color:#0086b3;">37</span><span>, </span><span style="color:#0086b3;">38</span><span>, </span><span style="color:#0086b3;">39</span><span>, </span><span style="color:#0086b3;">40</span><span>, </span><span style="color:#0086b3;">41</span><span>, </span><span style="color:#0086b3;">42</span><span>, </span><span style="color:#0086b3;">43</span><span>, </span><span style="color:#0086b3;">44</span><span>, </span><span style="color:#0086b3;">45</span><span>, </span><span style="color:#0086b3;">46</span><span>, </span><span style="color:#0086b3;">47</span><span> }
</span><span>BOTTOM_NOT_CONNECTED :: Candidates{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span>, </span><span style="color:#0086b3;">4</span><span>,  </span><span style="color:#0086b3;">5</span><span>,  </span><span style="color:#0086b3;">6</span><span>,  </span><span style="color:#0086b3;">7</span><span>,  </span><span style="color:#0086b3;">8</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">15</span><span>, </span><span style="color:#0086b3;">16</span><span>, </span><span style="color:#0086b3;">17</span><span>, </span><span style="color:#0086b3;">18</span><span>, </span><span style="color:#0086b3;">19</span><span>, </span><span style="color:#0086b3;">20</span><span>, </span><span style="color:#0086b3;">21</span><span>, </span><span style="color:#0086b3;">22</span><span>, </span><span style="color:#0086b3;">23</span><span>, </span><span style="color:#0086b3;">24</span><span>, </span><span style="color:#0086b3;">25</span><span>, </span><span style="color:#0086b3;">26</span><span>, </span><span style="color:#0086b3;">27</span><span>, </span><span style="color:#0086b3;">28</span><span>, </span><span style="color:#0086b3;">29</span><span>, </span><span style="color:#0086b3;">30</span><span>, </span><span style="color:#0086b3;">31</span><span> }
</span></code></pre>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">tile_connections</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> (c: Cell) -&gt; (ret: Candidate_Set) {
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">switch</span><span> t </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> c {
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">case</span><span> Tile: 
</span><span>        ret[.North]  = .North  </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t ? SOUTH_CONNECTED  : SOUTH_NOT_CONNECTED
</span><span>        ret[.East]   = .East   </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t ? WEST_CONNECTED   : WEST_NOT_CONNECTED
</span><span>        ret[.South]  = .South  </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t ? NORTH_CONNECTED  : NORTH_NOT_CONNECTED
</span><span>        ret[.West]   = .West   </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t ? EAST_CONNECTED   : EAST_NOT_CONNECTED
</span><span>        ret[.Top]    = .Top    </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t ? BOTTOM_CONNECTED : BOTTOM_NOT_CONNECTED
</span><span>        ret[.Bottom] = .Bottom </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t ? TOP_CONNECTED    : TOP_NOT_CONNECTED
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">case</span><span>:
</span><span>        ret = ~{}
</span><span>    }
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return
</span><span>}
</span></code></pre>
<p>Then edit <code>grid_init</code> to adjust the candidates in the edge cubes accordingly. However, care must be taken as how these values translate there. For example, the westernmost cubes are the ones that do <em>not</em> have a connection on the <code>.West</code> side. Again, I am not currently sure how correct this is. The pudding is yet to be eaten.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">grid_init</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> () -&gt; (ret: Grid) {
</span><span>    </span><span style="font-style:italic;color:#969896;">// Fill the candidate Grid
</span><span>    ret.candidates = ~Candidates{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">63</span><span> }
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> z </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4</span><span> {
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> x == </span><span style="color:#0086b3;">0 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> ret.candidates[x][y][z] &amp;= WEST_NOT_CONNECTED
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> x == </span><span style="color:#0086b3;">3 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> ret.candidates[x][y][z] &amp;= EAST_NOT_CONNECTED
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> y == </span><span style="color:#0086b3;">0 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> ret.candidates[x][y][z] &amp;= SOUTH_NOT_CONNECTED
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> y == </span><span style="color:#0086b3;">3 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> ret.candidates[x][y][z] &amp;= NORTH_NOT_CONNECTED
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> z == </span><span style="color:#0086b3;">0 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> ret.candidates[x][y][z] &amp;= BOTTOM_NOT_CONNECTED
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> z == </span><span style="color:#0086b3;">3 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> ret.candidates[x][y][z] &amp;= TOP_NOT_CONNECTED
</span><span>    }
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// Place Blue and Red cubes respectively
</span><span>    ret.cells[</span><span style="color:#0086b3;">1</span><span>][</span><span style="color:#0086b3;">1</span><span>][</span><span style="color:#0086b3;">1</span><span>] = ~Tile{}
</span><span>    ret.cells[</span><span style="color:#0086b3;">2</span><span>][</span><span style="color:#0086b3;">2</span><span>][</span><span style="color:#0086b3;">2</span><span>] = Tile{}
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// still a placeholder
</span><span>    </span><span style="color:#62a35c;">grid_propagate</span><span>(&amp;ret)
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return 
</span><span>}
</span></code></pre>
<h3 id="propagation-and-controlled-demolition">Propagation and Controlled Demolition</h3>
<p>Applying minor changes from the Square Gardens' <code>grid_propgagate</code> and <code>grid_controlled_demolition</code>, they end up like this.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">grid_propagate</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> (grid: ^Grid) -&gt; </span><span style="font-weight:bold;color:#a71d5d;">bool</span><span> {
</span><span>    </span><span style="font-style:italic;color:#969896;">// Update candidates based on cells
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> z </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4</span><span> {
</span><span>        cell := grid.cells[x][y][z]
</span><span>        tc := </span><span style="color:#62a35c;">tile_connections</span><span>(cell)
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> y &lt; </span><span style="color:#0086b3;">3 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x][y + </span><span style="color:#0086b3;">1</span><span>][z] &amp;= tc[.North]
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> x &lt; </span><span style="color:#0086b3;">3 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x + </span><span style="color:#0086b3;">1</span><span>][y][z] &amp;= tc[.East]
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> y &gt; </span><span style="color:#0086b3;">0 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x][y - </span><span style="color:#0086b3;">1</span><span>][z] &amp;= tc[.South]
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> x &gt; </span><span style="color:#0086b3;">0 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x - </span><span style="color:#0086b3;">1</span><span>][y][z] &amp;= tc[.West]
</span><span>        </span><span style="font-style:italic;color:#969896;">// Top
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> z &lt; </span><span style="color:#0086b3;">3 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x][y][z + </span><span style="color:#0086b3;">1</span><span>] &amp;= tc[.Top]
</span><span>        </span><span style="font-style:italic;color:#969896;">// Bottom
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> z &gt; </span><span style="color:#0086b3;">0 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x][y][z - </span><span style="color:#0086b3;">1</span><span>] &amp;= tc[.Bottom]
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> tile, ok := cell.(Tile); ok {
</span><span>            </span><span style="font-style:italic;color:#969896;">// Weird magic
</span><span>            cand := Candidates{ </span><span style="font-weight:bold;color:#a71d5d;">int</span><span> (</span><span style="font-weight:bold;color:#a71d5d;">transmute</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>)tile) }
</span><span>        
</span><span>            grid.candidates -= cand
</span><span>            grid.candidates[x][y][z] = cand
</span><span>        }
</span><span>    }
</span><span>
</span><span>    any_collapsed := </span><span style="color:#0086b3;">false
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// Update cells based on candidates
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> z </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4</span><span>  {
</span><span>        cand := grid.candidates[x][y][z]
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> cand == {} </span><span style="font-weight:bold;color:#a71d5d;">do return </span><span style="color:#0086b3;">false
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> grid.cells[x][y][z] == </span><span style="color:#0086b3;">nil</span><span> &amp;&amp; </span><span style="color:#62a35c;">card</span><span>(cand) == </span><span style="color:#0086b3;">1 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> id </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> cand {
</span><span>            any_collapsed = </span><span style="color:#0086b3;">true
</span><span>
</span><span>            grid.cells[x][y][z] = </span><span style="font-weight:bold;color:#a71d5d;">transmute</span><span>(Tile)</span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>(id)
</span><span>        }
</span><span>    }
</span><span>
</span><span>    success := </span><span style="color:#0086b3;">true
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> any_collapsed </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> success = </span><span style="color:#62a35c;">grid_propagate</span><span>(grid) </span><span style="font-style:italic;color:#969896;">// recursion!!
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return</span><span> success
</span><span>}
</span></code></pre>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">grid_controlled_demolition</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> (grid: ^Grid) -&gt; </span><span style="font-weight:bold;color:#a71d5d;">bool</span><span> {
</span><span>    </span><span style="font-style:italic;color:#969896;">// all the shuffling 
</span><span>    rows := []</span><span style="font-weight:bold;color:#a71d5d;">int</span><span>{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span> }
</span><span>    rand.</span><span style="color:#62a35c;">shuffle</span><span>(rows)
</span><span>    
</span><span>    cols := []</span><span style="font-weight:bold;color:#a71d5d;">int</span><span>{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span> }
</span><span>    rand.</span><span style="color:#62a35c;">shuffle</span><span>(cols)
</span><span>
</span><span>    verts := []</span><span style="font-weight:bold;color:#a71d5d;">int</span><span>{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span> }
</span><span>    rand.</span><span style="color:#62a35c;">shuffle</span><span>(verts)
</span><span>    
</span><span>    ids := []</span><span style="font-weight:bold;color:#a71d5d;">int</span><span>{ </span><span style="color:#0086b3;">0</span><span>,  </span><span style="color:#0086b3;">1</span><span>,  </span><span style="color:#0086b3;">2</span><span>,  </span><span style="color:#0086b3;">3</span><span>,  </span><span style="color:#0086b3;">4</span><span>,  </span><span style="color:#0086b3;">5</span><span>,  </span><span style="color:#0086b3;">6</span><span>,  </span><span style="color:#0086b3;">7</span><span>,  </span><span style="color:#0086b3;">8</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">15</span><span>,
</span><span>                 </span><span style="color:#0086b3;">16</span><span>, </span><span style="color:#0086b3;">17</span><span>, </span><span style="color:#0086b3;">18</span><span>, </span><span style="color:#0086b3;">19</span><span>, </span><span style="color:#0086b3;">20</span><span>, </span><span style="color:#0086b3;">21</span><span>, </span><span style="color:#0086b3;">22</span><span>, </span><span style="color:#0086b3;">23</span><span>, </span><span style="color:#0086b3;">24</span><span>, </span><span style="color:#0086b3;">25</span><span>, </span><span style="color:#0086b3;">26</span><span>, </span><span style="color:#0086b3;">27</span><span>, </span><span style="color:#0086b3;">28</span><span>, </span><span style="color:#0086b3;">29</span><span>, </span><span style="color:#0086b3;">30</span><span>, </span><span style="color:#0086b3;">31</span><span>,
</span><span>                 </span><span style="color:#0086b3;">32</span><span>, </span><span style="color:#0086b3;">33</span><span>, </span><span style="color:#0086b3;">34</span><span>, </span><span style="color:#0086b3;">35</span><span>, </span><span style="color:#0086b3;">36</span><span>, </span><span style="color:#0086b3;">37</span><span>, </span><span style="color:#0086b3;">38</span><span>, </span><span style="color:#0086b3;">39</span><span>, </span><span style="color:#0086b3;">40</span><span>, </span><span style="color:#0086b3;">41</span><span>, </span><span style="color:#0086b3;">42</span><span>, </span><span style="color:#0086b3;">43</span><span>, </span><span style="color:#0086b3;">44</span><span>, </span><span style="color:#0086b3;">45</span><span>, </span><span style="color:#0086b3;">46</span><span>, </span><span style="color:#0086b3;">47</span><span>,
</span><span>                 </span><span style="color:#0086b3;">48</span><span>, </span><span style="color:#0086b3;">49</span><span>, </span><span style="color:#0086b3;">50</span><span>, </span><span style="color:#0086b3;">51</span><span>, </span><span style="color:#0086b3;">52</span><span>, </span><span style="color:#0086b3;">53</span><span>, </span><span style="color:#0086b3;">54</span><span>, </span><span style="color:#0086b3;">55</span><span>, </span><span style="color:#0086b3;">56</span><span>, </span><span style="color:#0086b3;">57</span><span>, </span><span style="color:#0086b3;">58</span><span>, </span><span style="color:#0086b3;">59</span><span>, </span><span style="color:#0086b3;">60</span><span>, </span><span style="color:#0086b3;">61</span><span>, </span><span style="color:#0086b3;">62</span><span>, </span><span style="color:#0086b3;">63</span><span>}
</span><span>    rand.</span><span style="color:#62a35c;">shuffle</span><span>(ids)
</span><span>
</span><span>    t_x, t_y, t_z: </span><span style="font-weight:bold;color:#a71d5d;">int
</span><span>
</span><span>    min_card := </span><span style="color:#62a35c;">max</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">int</span><span>)
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> z </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> verts </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> cols </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> rows {
</span><span>        c := </span><span style="color:#62a35c;">card</span><span>(grid.candidates[x][y][z])
</span><span>        (c &gt; </span><span style="color:#0086b3;">1</span><span>) </span><span style="font-weight:bold;color:#a71d5d;">or_continue
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> c &lt; min_card {
</span><span>            t_x = x
</span><span>            t_y = y
</span><span>            t_z = z
</span><span>            min_card = c
</span><span>        }
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> min_card == </span><span style="color:#0086b3;">2 </span><span style="font-weight:bold;color:#a71d5d;">do break
</span><span>    }
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> id </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> ids </span><span style="font-weight:bold;color:#a71d5d;">do if</span><span> id </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> grid.candidates[t_x][t_y][t_z] {
</span><span>        tile := </span><span style="font-weight:bold;color:#a71d5d;">transmute</span><span>(Tile)</span><span style="font-weight:bold;color:#a71d5d;">i8</span><span>(id)
</span><span>        cand := Candidates{ id }
</span><span>
</span><span>        grid.cells[t_x][t_y][t_z] = tile
</span><span>        grid.candidates -= cand
</span><span>        grid.candidates[t_x][t_y][t_z] = cand
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">break
</span><span>    }
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return </span><span style="color:#62a35c;">grid_propagate</span><span>(grid)
</span><span>}
</span></code></pre>
<p>And this does it. Figuring out how to ascertain how every cell in the grid has only one candidate took a bit of finessing and experimenting with Odin's core library <code>slice.all_in_proc</code>, but I ended up doing it manually.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">main</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> () {
</span><span>    grid := </span><span style="color:#62a35c;">grid_init</span><span>()
</span><span>
</span><span>    outer: </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> {
</span><span>        inner: </span><span style="font-weight:bold;color:#a71d5d;">for </span><span style="color:#62a35c;">grid_controlled_demolition</span><span>(&amp;grid) {
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> z </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4</span><span> {
</span><span>                </span><span style="font-weight:bold;color:#a71d5d;">if </span><span style="color:#62a35c;">card</span><span>(grid.candidates[x][y][z]) != </span><span style="color:#0086b3;">1 </span><span style="font-weight:bold;color:#a71d5d;">do continue</span><span> inner
</span><span>            }
</span><span>
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">break</span><span> outer
</span><span>        }
</span><span>        grid = </span><span style="color:#62a35c;">grid_init</span><span>()
</span><span>    }
</span><span>    
</span><span>    </span><span style="color:#62a35c;">grid_draw</span><span>(grid) </span><span style="font-style:italic;color:#969896;">// &lt;-- this one is a bit more interesting.
</span><span>}
</span></code></pre>
<p>This works, and thankfully halts. However, the execution time, in the few times I ran it, varied anything between 3 seconds and one minute. This obviously depends on how <em>lucky</em> the random seed is. Using threads would help to get a result faster.</p>
<p>Printing the solution naïvely prints a bunch of numbers, with no repeats (as far I could tell), but to verify that the solution is correct it needs to be outputted into a readable format. THe "easy" solution is to put together a dictionary of images and make a collage, much like the image at the top of the section, but that is not very interesting.</p>
<h3 id="solution-output">Solution Output</h3>
<p>Simply printing out the resultant grid to console is not a very useful output. With the Square Gardens, it is possible to verify the correctness of the result by simply checking, visually, that each number/square is the only one in the grid that has neighbors in a specific configuration.</p>
<p>In other words, look at this grid given from before (with pointless empty spaces removed and the Red Square <code>00</code> added):</p>
<pre style="background-color:#ffffff;color:#323232;"><code><span>|  |  |  |  |  |  |
</span><span>|  |00|  |  |02|  |
</span><span>|  |  |03|07|12|  |
</span><span>|  |  |11|14|  |  |
</span><span>|  |  |09|15|04|  |
</span><span>|  |  |  |10|  |  |
</span><span>|  |01|05|13|06|  |
</span><span>|  |  |  |  |08|  |
</span><span>|  |  |  |  |  |  |
</span></code></pre>
<p>It is easy to verify that, for example, <code>08</code> is literally the only tile that has only one connection to the top (and whether in code that's <code>North</code> or <code>South</code> is irrelevant to the correctness of the solution.) <code>14</code>, for example, is the only tile that has only three connections to the top, left, and bottom, and so on for all of them.</p>
<p>For the packed solution, it is harder to verify that over text output. One solution would be to create a little image for every cube, (as Freeling's provided solution does) and pack them together. The other solution is to render a 3D image of the solution and visually inspect it that way.</p>
<p>Looking over Odin's <code>vendor</code> libraries, and asking around for ideas how to do that, I could not figure out how to draw on an image canvas (the way the <a href="https://docs.rs/imageproc/latest/imageproc/"><code>imageproc</code></a> lets me do in Rust.) But there are a few bindings to different graphics libraries, and word on the street was that <a href="https://www.raylib.com"><code>raylib</code></a> is the simplest solution for this sort of thing.</p>
<p>I spent a day playing around with <code>raylib</code>'s tutorials and asking for help on the Discord. The API is ... weirder than I am used to, to say the least. But it looks simple enough. To draw a window with a render scene, the code is the following:</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#a71d5d;">import</span><span> rl </span><span style="color:#183691;">&quot;vendor:raylib&quot;
</span><span>
</span><span style="font-weight:bold;color:#795da3;">grid_draw</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> (grid: Grid) {
</span><span>    SCREEN_WIDTH  :: </span><span style="color:#0086b3;">400
</span><span>    SCREEN_HEIGHT :: </span><span style="color:#0086b3;">200
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// raylib must start with this.
</span><span>    rl.</span><span style="color:#62a35c;">InitWindow</span><span>(SCREEN_WIDTH, SCREEN_HEIGHT, </span><span style="color:#183691;">&quot;&quot;</span><span>)
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// and end with this.
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">defer</span><span> rl.</span><span style="color:#62a35c;">CloseWindow</span><span>()
</span><span>
</span><span>    camera := rl.Camera3D{
</span><span>        position   = ({</span><span style="color:#0086b3;">10.0</span><span>, -</span><span style="color:#0086b3;">5.0</span><span>, </span><span style="color:#0086b3;">5.0</span><span>} + </span><span style="color:#0086b3;">2.5</span><span>), 
</span><span>        target     = {</span><span style="color:#0086b3;">2.5</span><span>, </span><span style="color:#0086b3;">2.5</span><span>, </span><span style="color:#0086b3;">2.5</span><span>},
</span><span>        up         = {</span><span style="color:#0086b3;">0.0</span><span>, </span><span style="color:#0086b3;">1.0</span><span>, </span><span style="color:#0086b3;">0.0</span><span>}, 
</span><span>        fovy       = </span><span style="color:#0086b3;">50</span><span>, 
</span><span>        projection = .ORTHOGRAPHIC
</span><span>    }
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> !rl.</span><span style="color:#62a35c;">WindowShouldClose</span><span>() {
</span><span>        rl.</span><span style="color:#62a35c;">UpdateCamera</span><span>(&amp;camera, .THIRD_PERSON)
</span><span>
</span><span>        </span><span style="font-style:italic;color:#969896;">// This honestly weird pattern is how everything in raylib must work
</span><span>        rl.</span><span style="color:#62a35c;">BeginDrawing</span><span>()
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">defer</span><span> rl.</span><span style="color:#62a35c;">EndDrawing</span><span>()
</span><span>
</span><span>        rl.</span><span style="color:#62a35c;">ClearBackground</span><span>(rl.WHITE)
</span><span>
</span><span>        rl.</span><span style="color:#62a35c;">BeginMode3D</span><span>(camera)
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">defer</span><span> rl.</span><span style="color:#62a35c;">EndMode3D</span><span>()
</span><span>
</span><span>        </span><span style="font-style:italic;color:#969896;">// draw 3D things here.
</span><span>    }
</span><span>}
</span></code></pre>
<p>Just to test things out, I will try drawing each cube with a different shade based on how many connections it has. The Blue cube shall be blue and the Red cube shall be red, and the other cubes will be different shades of purple.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#a71d5d;">for</span><span> z </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt; </span><span style="color:#0086b3;">4</span><span> {
</span><span>    tile := grid.cells[x][y][z].(Tile) </span><span style="font-weight:bold;color:#a71d5d;">or_continue
</span><span>    grade := </span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>(</span><span style="color:#62a35c;">card</span><span>(tile))
</span><span>
</span><span>    b := (</span><span style="color:#62a35c;">max</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>) / </span><span style="color:#0086b3;">6</span><span>) * grade
</span><span>    r := </span><span style="color:#62a35c;">max</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>) - b
</span><span>
</span><span>    rl.</span><span style="color:#62a35c;">DrawCubeV</span><span>({</span><span style="font-weight:bold;color:#a71d5d;">f32</span><span>(x), </span><span style="font-weight:bold;color:#a71d5d;">f32</span><span>(y), </span><span style="font-weight:bold;color:#a71d5d;">f32</span><span>(z)}, </span><span style="color:#0086b3;">1.0</span><span>, {r, </span><span style="color:#0086b3;">0</span><span>, b, </span><span style="color:#0086b3;">255</span><span>})
</span><span>}
</span></code></pre>
<p>And now: the moment of truth <code>odin run .</code></p>
<p><img src="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/first_test.png" alt="weird mush of colors" /></p>
<p>I have <em>no</em> idea what's going on here. Everything is mushed together and the screen is tiny. Upping the screen's resolution (to <code>800, 400</code>), multiplying the position by <code>2.0</code> would be a start, and bringing the camera closer would be a decent start.<sup class="footnote-reference" id="fr-iterating-1"><a href="#fn-iterating">7</a></sup></p>
<p><img src="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/second_test.png" alt="different much of colors" /></p>
<p>Ah .. much better already. This actually rotates (but not zooms) with the mouse movement, thanks to that <code>.THIRD_PERSON</code> setting up there. Time to draw the lines, and better organize the code while I am at it. Here is the full function. (I do not actually expect this to be correct.)</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">grid_draw</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span>(grid: Grid) {
</span><span>    SCREEN_WIDTH  :: </span><span style="color:#0086b3;">1200
</span><span>    SCREEN_HEIGHT :: </span><span style="color:#0086b3;">600
</span><span>
</span><span>    CUBE_DISTANCE :: </span><span style="color:#0086b3;">3.0
</span><span>    CENTER_POINT  :: </span><span style="color:#0086b3;">2.5</span><span> * CUBE_DISTANCE
</span><span>
</span><span>    rl.</span><span style="color:#62a35c;">InitWindow</span><span>(SCREEN_WIDTH, SCREEN_HEIGHT, </span><span style="color:#183691;">&quot;&quot;</span><span>)
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">defer</span><span> rl.</span><span style="color:#62a35c;">CloseWindow</span><span>()
</span><span>
</span><span>    camera := rl.Camera3D {
</span><span>        position   = ({</span><span style="color:#0086b3;">10.0</span><span>, -</span><span style="color:#0086b3;">5.0</span><span>, </span><span style="color:#0086b3;">5.0</span><span>} + CENTER_POINT),
</span><span>        target     = CENTER_POINT,
</span><span>        up         = {</span><span style="color:#0086b3;">0.0</span><span>, </span><span style="color:#0086b3;">1.0</span><span>, </span><span style="color:#0086b3;">0.0</span><span>},
</span><span>        fovy       = </span><span style="color:#0086b3;">30</span><span>,
</span><span>        projection = .ORTHOGRAPHIC,
</span><span>    }
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> !rl.</span><span style="color:#62a35c;">WindowShouldClose</span><span>() {
</span><span>        rl.</span><span style="color:#62a35c;">UpdateCamera</span><span>(&amp;camera, .THIRD_PERSON)
</span><span>
</span><span>        rl.</span><span style="color:#62a35c;">BeginDrawing</span><span>()
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">defer</span><span> rl.</span><span style="color:#62a35c;">EndDrawing</span><span>()
</span><span>
</span><span>        rl.</span><span style="color:#62a35c;">ClearBackground</span><span>(rl.WHITE)
</span><span>
</span><span>        rl.</span><span style="color:#62a35c;">BeginMode3D</span><span>(camera)
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">defer</span><span> rl.</span><span style="color:#62a35c;">EndMode3D</span><span>()
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> z </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span> ..&lt; </span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span> ..&lt; </span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span> ..&lt; </span><span style="color:#0086b3;">4</span><span> {
</span><span>            tile := grid.cells[x][y][z].(Tile) </span><span style="font-weight:bold;color:#a71d5d;">or_continue
</span><span>            grade := </span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>(</span><span style="color:#62a35c;">card</span><span>(tile))
</span><span>
</span><span>            pos  := rl.Vector3{</span><span style="font-weight:bold;color:#a71d5d;">f32</span><span>(x), </span><span style="font-weight:bold;color:#a71d5d;">f32</span><span>(y), </span><span style="font-weight:bold;color:#a71d5d;">f32</span><span>(z)} * CUBE_DISTANCE
</span><span>            size := rl.Vector3{ </span><span style="color:#0086b3;">1.0</span><span>, </span><span style="color:#0086b3;">1.0</span><span>, </span><span style="color:#0086b3;">1.0</span><span> }
</span><span>
</span><span>            b := (</span><span style="color:#62a35c;">max</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>) / </span><span style="color:#0086b3;">6</span><span>) * grade
</span><span>            r := </span><span style="color:#62a35c;">max</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>) - b
</span><span>
</span><span>            color := rl.Color{ r, </span><span style="color:#0086b3;">0</span><span>, b, </span><span style="color:#0086b3;">255</span><span>}
</span><span>
</span><span>            rl.</span><span style="color:#62a35c;">DrawCubeV</span><span>( pos, size, color )
</span><span>
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .North  </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> rl.</span><span style="color:#62a35c;">DrawLine3D</span><span>(pos, pos + {</span><span style="color:#0086b3;">0</span><span>,  CUBE_DISTANCE / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>}, rl.BLACK)
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .South  </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> rl.</span><span style="color:#62a35c;">DrawLine3D</span><span>(pos, pos + {</span><span style="color:#0086b3;">0</span><span>, -CUBE_DISTANCE / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>}, rl.BLACK)
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .East   </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> rl.</span><span style="color:#62a35c;">DrawLine3D</span><span>(pos, pos + { CUBE_DISTANCE / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>}, rl.BLACK)
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .West   </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> rl.</span><span style="color:#62a35c;">DrawLine3D</span><span>(pos, pos + {-CUBE_DISTANCE / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>}, rl.BLACK)
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .Top    </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> rl.</span><span style="color:#62a35c;">DrawLine3D</span><span>(pos, pos + {</span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>,  CUBE_DISTANCE / </span><span style="color:#0086b3;">2</span><span>}, rl.BLACK)
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .Bottom </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> rl.</span><span style="color:#62a35c;">DrawLine3D</span><span>(pos, pos + {</span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>, -CUBE_DISTANCE / </span><span style="color:#0086b3;">2</span><span>}, rl.BLACK)
</span><span>        }
</span><span>    }
</span><span>}
</span><span>
</span></code></pre>
<p><img src="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/third_test.png" alt="wired mesh of colors" /></p>
<p>This looks .. ok? half decent? Rotating it around does not show any mistakes. The centering is off, however. And due to the Orthographic projection and camera work I cannot zoom in to see how everything connects in more detail.</p>
<h3 id="faster-iteration-of-visuals">Faster Iteration of Visuals</h3>
<p>Also, frankly, I am getting tired of waiting for the solution to solve before the render show up, so I am changing the code a bit to, maybe, see the cube solve it in real time. This makes the solver <em>much</em> slower, but it makes for a fun animation.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span>SCREEN_WIDTH  :: </span><span style="color:#0086b3;">800
</span><span>SCREEN_HEIGHT :: </span><span style="color:#0086b3;">800
</span><span>
</span><span>CUBE_DISTANCE :: </span><span style="color:#0086b3;">3.0
</span><span>CENTER_POINT  :: </span><span style="color:#0086b3;">1.5</span><span> * CUBE_DISTANCE
</span><span>
</span><span style="font-weight:bold;color:#795da3;">main</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> () {
</span><span>
</span><span>    rl.</span><span style="color:#62a35c;">InitWindow</span><span>(SCREEN_WIDTH, SCREEN_HEIGHT, </span><span style="color:#183691;">&quot;&quot;</span><span>)
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">defer</span><span> rl.</span><span style="color:#62a35c;">CloseWindow</span><span>()
</span><span>
</span><span>    rl.</span><span style="color:#62a35c;">SetTargetFPS</span><span>(</span><span style="color:#0086b3;">60</span><span>)
</span><span>
</span><span>    camera := rl.Camera3D {
</span><span>        position   = ({</span><span style="color:#0086b3;">10.0</span><span>, -</span><span style="color:#0086b3;">5.0</span><span>, </span><span style="color:#0086b3;">5.0</span><span>} + CENTER_POINT),
</span><span>        target     = CENTER_POINT,
</span><span>        up         = {</span><span style="color:#0086b3;">0.0</span><span>, </span><span style="color:#0086b3;">1.0</span><span>, </span><span style="color:#0086b3;">0.0</span><span>},
</span><span>        fovy       = </span><span style="color:#0086b3;">30</span><span>,
</span><span>        projection = .ORTHOGRAPHIC,
</span><span>    }
</span><span>
</span><span>    grid   := </span><span style="color:#62a35c;">grid_init</span><span>()
</span><span>    solved := </span><span style="color:#0086b3;">false
</span><span>    paused := </span><span style="color:#0086b3;">false
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> !rl.</span><span style="color:#62a35c;">WindowShouldClose</span><span>() {
</span><span>        rl.</span><span style="color:#62a35c;">UpdateCamera</span><span>(&amp;camera, .THIRD_PERSON)
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> rl.</span><span style="color:#62a35c;">IsKeyPressed</span><span>(.SPACE) </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> paused ~= </span><span style="color:#0086b3;">true
</span><span>
</span><span>        {    </span><span style="font-style:italic;color:#969896;">// Draw current state
</span><span>            rl.</span><span style="color:#62a35c;">BeginDrawing</span><span>()
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">defer</span><span> rl.</span><span style="color:#62a35c;">EndDrawing</span><span>()
</span><span>    
</span><span>            rl.</span><span style="color:#62a35c;">ClearBackground</span><span>(rl.WHITE)
</span><span>    
</span><span>            rl.</span><span style="color:#62a35c;">BeginMode3D</span><span>(camera)
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">defer</span><span> rl.</span><span style="color:#62a35c;">EndMode3D</span><span>()
</span><span>
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> z </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span> ..&lt; </span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span> ..&lt; </span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span> ..&lt; </span><span style="color:#0086b3;">4</span><span> {
</span><span>                tile := grid.cells[x][y][z].(Tile) </span><span style="font-weight:bold;color:#a71d5d;">or_continue
</span><span>                grade := </span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>(</span><span style="color:#62a35c;">card</span><span>(tile))
</span><span>    
</span><span>                pos  := rl.Vector3{</span><span style="font-weight:bold;color:#a71d5d;">f32</span><span>(x), </span><span style="font-weight:bold;color:#a71d5d;">f32</span><span>(y), </span><span style="font-weight:bold;color:#a71d5d;">f32</span><span>(z)} * CUBE_DISTANCE
</span><span>                size := rl.Vector3{ </span><span style="color:#0086b3;">1.0</span><span>, </span><span style="color:#0086b3;">1.0</span><span>, </span><span style="color:#0086b3;">1.0</span><span> }
</span><span>    
</span><span>                b := (</span><span style="color:#62a35c;">max</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>) / </span><span style="color:#0086b3;">6</span><span>) * grade
</span><span>                r := </span><span style="color:#62a35c;">max</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>) - b
</span><span>    
</span><span>                color := rl.Color{ r, </span><span style="color:#0086b3;">0</span><span>, b, </span><span style="color:#0086b3;">255</span><span>}
</span><span>    
</span><span>                rl.</span><span style="color:#62a35c;">DrawCubeV</span><span>( pos, size, color )
</span><span>    
</span><span>                </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .North  </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> rl.</span><span style="color:#62a35c;">DrawLine3D</span><span>(pos, pos + {</span><span style="color:#0086b3;">0</span><span>,  CUBE_DISTANCE / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>}, rl.BLACK)
</span><span>                </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .South  </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> rl.</span><span style="color:#62a35c;">DrawLine3D</span><span>(pos, pos + {</span><span style="color:#0086b3;">0</span><span>, -CUBE_DISTANCE / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>}, rl.BLACK)
</span><span>                </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .East   </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> rl.</span><span style="color:#62a35c;">DrawLine3D</span><span>(pos, pos + { CUBE_DISTANCE / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>}, rl.BLACK)
</span><span>                </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .West   </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> rl.</span><span style="color:#62a35c;">DrawLine3D</span><span>(pos, pos + {-CUBE_DISTANCE / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>}, rl.BLACK)
</span><span>                </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .Top    </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> rl.</span><span style="color:#62a35c;">DrawLine3D</span><span>(pos, pos + {</span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>,  CUBE_DISTANCE / </span><span style="color:#0086b3;">2</span><span>}, rl.BLACK)
</span><span>                </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .Bottom </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> rl.</span><span style="color:#62a35c;">DrawLine3D</span><span>(pos, pos + {</span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>, -CUBE_DISTANCE / </span><span style="color:#0086b3;">2</span><span>}, rl.BLACK)
</span><span>            }
</span><span>        }
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> !paused &amp;&amp; !solved {
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if </span><span style="color:#62a35c;">grid_controlled_demolition</span><span>(&amp;grid) {
</span><span>                solved = </span><span style="color:#0086b3;">true
</span><span>                </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> z </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">4</span><span> {
</span><span>                    </span><span style="font-weight:bold;color:#a71d5d;">if </span><span style="color:#62a35c;">card</span><span>(grid.candidates[x][y][z]) != </span><span style="color:#0086b3;">1</span><span> {
</span><span>                        solved = </span><span style="color:#0086b3;">false 
</span><span>                        </span><span style="font-weight:bold;color:#a71d5d;">break
</span><span>                    }
</span><span>                }
</span><span>            } </span><span style="font-weight:bold;color:#a71d5d;">else</span><span> { 
</span><span>                grid = </span><span style="color:#62a35c;">grid_init</span><span>() 
</span><span>                solved = </span><span style="color:#0086b3;">false
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre>
<video controls width="400" autoplay="true">
  <source src="animation_1.mp4" type="video/mp4" />
</video>
<p>Well this is a lot more pleasant to look at, isn't it? One nicety: it pauses when the Space bar is pressed, easier to inspect the connections. It will find a solution in a million years, but until that happens it would be easier to iterate the presentation's colors and distances.</p>
<p>Miracolously, howver, no matter when I pause it, the connections between adaject cubes are always correct. There are no cubes that are next to each other with one line hanging midways between them. Every high five is reciprocated. This is a fancy screenshot for an attempted solution.</p>
<p><img src="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/fourth_test.png" alt="organized mesh of colors" /></p>
<h3 id="final-visuals">Final Visuals</h3>
<p>After a bit of trial and error and experimenting with different colors and distances and camera positions, I ended up with these constants and draw functions.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span>SCREEN_WIDTH  :: </span><span style="color:#0086b3;">800
</span><span>SCREEN_HEIGHT :: </span><span style="color:#0086b3;">800
</span><span>
</span><span>CUBE_DISTANCE_X :: </span><span style="color:#0086b3;">6.0
</span><span>CUBE_DISTANCE_Y :: </span><span style="color:#0086b3;">6.0
</span><span>CUBE_DISTANCE_Z :: </span><span style="color:#0086b3;">2.5
</span><span>
</span><span>CENTER_POINT :: [</span><span style="color:#0086b3;">3</span><span>]</span><span style="font-weight:bold;color:#a71d5d;">f32</span><span> {
</span><span>    </span><span style="color:#0086b3;">1.5</span><span> * CUBE_DISTANCE_X,
</span><span>    </span><span style="color:#0086b3;">1.5</span><span> * CUBE_DISTANCE_Y,
</span><span>    </span><span style="color:#0086b3;">1.5</span><span> * CUBE_DISTANCE_Z
</span><span>}
</span><span>
</span><span style="font-weight:bold;color:#795da3;">main</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> () {
</span><span>    </span><span style="font-style:italic;color:#969896;">// boring boilerplate
</span><span>
</span><span>    camera := rl.Camera3D {
</span><span>        position   = ({-</span><span style="color:#0086b3;">7</span><span>, -</span><span style="color:#0086b3;">7</span><span>, </span><span style="color:#0086b3;">15</span><span>} + CENTER_POINT),
</span><span>        target     = CENTER_POINT,
</span><span>        up         = {</span><span style="color:#0086b3;">0.0</span><span>, </span><span style="color:#0086b3;">0.0</span><span>, </span><span style="color:#0086b3;">1.0</span><span>},
</span><span>        fovy       = </span><span style="color:#0086b3;">35</span><span>,
</span><span>        projection = .ORTHOGRAPHIC,
</span><span>    }
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// other boring boilerplate
</span><span>    
</span><span>    rl.</span><span style="color:#62a35c;">ClearBackground</span><span>(rl.Color{ </span><span style="color:#0086b3;">240</span><span>, </span><span style="color:#0086b3;">240</span><span>, </span><span style="color:#0086b3;">240</span><span>, </span><span style="color:#0086b3;">255</span><span> })
</span><span>    
</span><span>    </span><span style="font-style:italic;color:#969896;">// you know
</span><span>    
</span><span>    pos  := rl.Vector3{
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">f32</span><span>(x) * CUBE_DISTANCE_X,
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">f32</span><span>(y) * CUBE_DISTANCE_Y,
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">f32</span><span>(z) * CUBE_DISTANCE_Z,
</span><span>    } 
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// more of it
</span><span>    
</span><span>    rl.</span><span style="color:#62a35c;">DrawCubeV</span><span>(pos, size, color)
</span><span>    rl.</span><span style="color:#62a35c;">DrawCubeWiresV</span><span>(pos, size, rl.BLACK)
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .North  </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile {
</span><span>        end_pos := pos + {</span><span style="color:#0086b3;">0</span><span>,  CUBE_DISTANCE_Y / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>}
</span><span>        rl.</span><span style="color:#62a35c;">DrawCylinderEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.ORANGE)
</span><span>        rl.</span><span style="color:#62a35c;">DrawCylinderWiresEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.BLACK)
</span><span>    }
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .South  </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile {
</span><span>        end_pos := pos + {</span><span style="color:#0086b3;">0</span><span>, -CUBE_DISTANCE_Y / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>}
</span><span>        rl.</span><span style="color:#62a35c;">DrawCylinderEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.ORANGE)
</span><span>        rl.</span><span style="color:#62a35c;">DrawCylinderWiresEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.BLACK)
</span><span>    }
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .East   </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile {
</span><span>        end_pos := pos + { CUBE_DISTANCE_X / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>}
</span><span>        rl.</span><span style="color:#62a35c;">DrawCylinderEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.DARKGREEN)
</span><span>        rl.</span><span style="color:#62a35c;">DrawCylinderWiresEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.BLACK)
</span><span>    }
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .West   </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile {
</span><span>    end_pos := pos + {-CUBE_DISTANCE_X / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>}
</span><span>        rl.</span><span style="color:#62a35c;">DrawCylinderEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.DARKGREEN)
</span><span>        rl.</span><span style="color:#62a35c;">DrawCylinderWiresEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.BLACK)
</span><span>    }
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .Top    </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile {
</span><span>        end_pos := pos + {</span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>,  CUBE_DISTANCE_Z / </span><span style="color:#0086b3;">2</span><span>}
</span><span>        rl.</span><span style="color:#62a35c;">DrawCylinderEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.YELLOW)
</span><span>        rl.</span><span style="color:#62a35c;">DrawCylinderWiresEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.BLACK)
</span><span>    }
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .Bottom </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile {
</span><span>        end_pos := pos + {</span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>, -CUBE_DISTANCE_Z / </span><span style="color:#0086b3;">2</span><span>}
</span><span>        rl.</span><span style="color:#62a35c;">DrawCylinderEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.YELLOW)
</span><span>        rl.</span><span style="color:#62a35c;">DrawCylinderWiresEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.BLACK)
</span><span>    }
</span><span>    </span><span style="font-style:italic;color:#969896;">// end of proc boilerplate
</span><span>}
</span></code></pre>
<p><img src="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/fifth_example.png" alt="final coloring" /></p>
<h3 id="producing-an-image">Producing an Image</h3>
<p>Well, now that apparently all the logic and visuals are top notch and as clear as they can be, I do not actually want a visual of the solver solving and taking for ever. I only want a final image. So I will revert <code>main</code> to what it was before, and adjust <code>grid_draw</code> so it only saves an image to disk, rather than opening a window and waiting for me to take a screenshot.</p>
<p>The code is mostly the same as before, only without starting a loop. <code>raylib</code> has functions to render a texture and save it as an image without third party libraries, so I just use those.</p>
<p>This is the final <code>grid_draw</code> and its resultant image</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">grid_draw</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span>(grid: Grid) {
</span><span>    rl.</span><span style="color:#62a35c;">SetConfigFlags</span><span>({.WINDOW_HIDDEN})
</span><span>    rl.</span><span style="color:#62a35c;">InitWindow</span><span>(SCREEN_WIDTH, SCREEN_HEIGHT, </span><span style="color:#183691;">&quot;&quot;</span><span>)
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">defer</span><span> rl.</span><span style="color:#62a35c;">CloseWindow</span><span>()
</span><span>
</span><span>    camera := rl.Camera3D {
</span><span>        position   = ({</span><span style="color:#0086b3;">7</span><span>, </span><span style="color:#0086b3;">7</span><span>, -</span><span style="color:#0086b3;">15</span><span>} + CENTER_POINT),
</span><span>        target     = CENTER_POINT,
</span><span>        up         = {</span><span style="color:#0086b3;">0.0</span><span>, </span><span style="color:#0086b3;">0.0</span><span>, </span><span style="color:#0086b3;">1.0</span><span>},
</span><span>        fovy       = </span><span style="color:#0086b3;">35</span><span>,
</span><span>        projection = .ORTHOGRAPHIC,
</span><span>    }
</span><span>
</span><span>    txtr := rl.</span><span style="color:#62a35c;">LoadRenderTexture</span><span>(SCREEN_WIDTH, SCREEN_HEIGHT)
</span><span>
</span><span>    {    </span><span style="font-style:italic;color:#969896;">// Drawing here
</span><span>        rl.</span><span style="color:#62a35c;">BeginTextureMode</span><span>(txtr)
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">defer</span><span> rl.</span><span style="color:#62a35c;">EndTextureMode</span><span>()
</span><span>
</span><span>        rl.</span><span style="color:#62a35c;">BeginDrawing</span><span>()
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">defer</span><span> rl.</span><span style="color:#62a35c;">EndDrawing</span><span>()
</span><span>
</span><span>        rl.</span><span style="color:#62a35c;">ClearBackground</span><span>(rl.Color{ </span><span style="color:#0086b3;">240</span><span>, </span><span style="color:#0086b3;">240</span><span>, </span><span style="color:#0086b3;">240</span><span>, </span><span style="color:#0086b3;">255</span><span> })
</span><span>
</span><span>        rl.</span><span style="color:#62a35c;">BeginMode3D</span><span>(camera)
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">defer</span><span> rl.</span><span style="color:#62a35c;">EndMode3D</span><span>()
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> z </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span> ..&lt; </span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span> ..&lt; </span><span style="color:#0086b3;">4 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span> ..&lt; </span><span style="color:#0086b3;">4</span><span> {
</span><span>            tile := grid.cells[x][y][z].(Tile) </span><span style="font-weight:bold;color:#a71d5d;">or_continue
</span><span>            grade := </span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>(</span><span style="color:#62a35c;">card</span><span>(tile))
</span><span>
</span><span>            pos := rl.Vector3{
</span><span>                </span><span style="font-weight:bold;color:#a71d5d;">f32</span><span>(x) * CUBE_DISTANCE_X,
</span><span>                </span><span style="font-weight:bold;color:#a71d5d;">f32</span><span>(y) * CUBE_DISTANCE_Y,
</span><span>                </span><span style="font-weight:bold;color:#a71d5d;">f32</span><span>(z) * CUBE_DISTANCE_Z
</span><span>            }
</span><span>
</span><span>            size := rl.Vector3{</span><span style="color:#0086b3;">1.0</span><span>, </span><span style="color:#0086b3;">1.0</span><span>, </span><span style="color:#0086b3;">1.0</span><span>}
</span><span>
</span><span>            b := (</span><span style="color:#62a35c;">max</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>) / </span><span style="color:#0086b3;">6</span><span>) * grade
</span><span>            r := </span><span style="color:#62a35c;">max</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>) - b
</span><span>
</span><span>            color := rl.Color{r, </span><span style="color:#0086b3;">0</span><span>, b, </span><span style="color:#0086b3;">255</span><span>}
</span><span>
</span><span>            rl.</span><span style="color:#62a35c;">DrawCubeV</span><span>(pos, size, color)
</span><span>            rl.</span><span style="color:#62a35c;">DrawCubeWiresV</span><span>(pos, size, rl.BLACK)
</span><span>
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .North </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile {
</span><span>                end_pos := pos + {</span><span style="color:#0086b3;">0</span><span>, CUBE_DISTANCE_Y / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>}
</span><span>                rl.</span><span style="color:#62a35c;">DrawCylinderEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.ORANGE)
</span><span>                rl.</span><span style="color:#62a35c;">DrawCylinderWiresEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.BLACK)
</span><span>            }
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .South </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile {
</span><span>                end_pos := pos + {</span><span style="color:#0086b3;">0</span><span>, -CUBE_DISTANCE_Y / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>}
</span><span>                rl.</span><span style="color:#62a35c;">DrawCylinderEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.ORANGE)
</span><span>                rl.</span><span style="color:#62a35c;">DrawCylinderWiresEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.BLACK)
</span><span>            }
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .East </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile {
</span><span>                end_pos := pos + {CUBE_DISTANCE_X / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>}
</span><span>                rl.</span><span style="color:#62a35c;">DrawCylinderEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.DARKGREEN)
</span><span>                rl.</span><span style="color:#62a35c;">DrawCylinderWiresEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.BLACK)
</span><span>            }
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .West </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile {
</span><span>                end_pos := pos + {-CUBE_DISTANCE_X / </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>}
</span><span>                rl.</span><span style="color:#62a35c;">DrawCylinderEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.DARKGREEN)
</span><span>                rl.</span><span style="color:#62a35c;">DrawCylinderWiresEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.BLACK)
</span><span>            }
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .Top </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile {
</span><span>                end_pos := pos + {</span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>, CUBE_DISTANCE_Z / </span><span style="color:#0086b3;">2</span><span>}
</span><span>                rl.</span><span style="color:#62a35c;">DrawCylinderEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.YELLOW)
</span><span>                rl.</span><span style="color:#62a35c;">DrawCylinderWiresEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.BLACK)
</span><span>            }
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .Bottom </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> tile {
</span><span>                end_pos := pos + {</span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">0</span><span>, -CUBE_DISTANCE_Z / </span><span style="color:#0086b3;">2</span><span>}
</span><span>                rl.</span><span style="color:#62a35c;">DrawCylinderEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.YELLOW)
</span><span>                rl.</span><span style="color:#62a35c;">DrawCylinderWiresEx</span><span>(pos, end_pos, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">0.1</span><span>, </span><span style="color:#0086b3;">12</span><span>, rl.BLACK)
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>
</span><span>    img := rl.</span><span style="color:#62a35c;">LoadImageFromTexture</span><span>(txtr.texture)
</span><span>    rl.</span><span style="color:#62a35c;">ExportImage</span><span>(img, </span><span style="color:#183691;">&quot;result.png&quot;</span><span>)
</span><span>}
</span></code></pre>
<p><img src="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/packed_garden.png" alt="Packed Squares Solution" /></p>
<hr />
<h2 id="hanging-gardens">Hanging Gardens</h2>
<p>With the Square Gardens and the Packed Gardens done, time to return to the original problem. Much of the different pieces of the solution are already in place, and it is just a question of assembling them together.</p>
<p>The main problem left is how to determine the proper size of the grid. It needs to be big enough to potentially accept any variation of the problem, but small enough that it does not cause a stack overflow. When I was experimenting with it, I tried a grid of size 31x31x31 and the Odin compiler warnned<sup class="footnote-reference" id="fr-warning-1"><a href="#fn-warning">8</a></sup> me that it is so big it might cause said overflow. Or might just put it on the heap and let the OS take care of cleaning it from memory.</p>
<h3 id="frankenstein-s-monster">Frankenstein's Monster</h3>
<p>This is the full program, with a helpful <code>GRID_SIZE</code> constant that allowed me to iterate and debug a bit with a smaller grid size.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#a71d5d;">package</span><span> hanging_gardens
</span><span>
</span><span style="font-weight:bold;color:#a71d5d;">import </span><span style="color:#183691;">&quot;core:fmt&quot;
</span><span style="font-weight:bold;color:#a71d5d;">import </span><span style="color:#183691;">&quot;core:math/rand&quot;
</span><span>
</span><span>GRID_SIZE :: </span><span style="color:#0086b3;">31
</span><span>MID_POINT :: (GRID_SIZE - </span><span style="color:#0086b3;">1</span><span>) / </span><span style="color:#0086b3;">2
</span><span>
</span><span>Side :: </span><span style="font-weight:bold;color:#a71d5d;">enum u8</span><span> { North, East, South, West, Top, Bottom }
</span><span>Tile :: </span><span style="font-weight:bold;color:#a71d5d;">distinct bit_set</span><span>[Side; </span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>]
</span><span>
</span><span>Air :: </span><span style="font-weight:bold;color:#a71d5d;">distinct struct</span><span> {}
</span><span>
</span><span>Cell :: </span><span style="font-weight:bold;color:#a71d5d;">union</span><span> { Air, Tile }
</span><span>Candidates :: </span><span style="font-weight:bold;color:#a71d5d;">distinct bit_set</span><span>[</span><span style="color:#0086b3;">0</span><span>..&lt;</span><span style="color:#0086b3;">64</span><span>; </span><span style="font-weight:bold;color:#a71d5d;">u64</span><span>]
</span><span>
</span><span>Grid :: </span><span style="font-weight:bold;color:#a71d5d;">struct</span><span> {
</span><span>    cells:      [GRID_SIZE][GRID_SIZE][GRID_SIZE]Cell,
</span><span>    candidates: [GRID_SIZE][GRID_SIZE][GRID_SIZE]Candidates,
</span><span>}
</span><span>
</span><span>Candidate_Set :: [Side]Candidates
</span><span>
</span><span>NORTH_CONNECTED  :: Candidates { </span><span style="color:#0086b3;">1</span><span>,  </span><span style="color:#0086b3;">3</span><span>,  </span><span style="color:#0086b3;">5</span><span>,  </span><span style="color:#0086b3;">7</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">15</span><span>, </span><span style="color:#0086b3;">17</span><span>, </span><span style="color:#0086b3;">19</span><span>, </span><span style="color:#0086b3;">21</span><span>, </span><span style="color:#0086b3;">23</span><span>, </span><span style="color:#0086b3;">25</span><span>, </span><span style="color:#0086b3;">27</span><span>, </span><span style="color:#0086b3;">29</span><span>, </span><span style="color:#0086b3;">31</span><span>, </span><span style="color:#0086b3;">33</span><span>, </span><span style="color:#0086b3;">35</span><span>, </span><span style="color:#0086b3;">37</span><span>, </span><span style="color:#0086b3;">39</span><span>, </span><span style="color:#0086b3;">41</span><span>, </span><span style="color:#0086b3;">43</span><span>, </span><span style="color:#0086b3;">45</span><span>, </span><span style="color:#0086b3;">47</span><span>, </span><span style="color:#0086b3;">49</span><span>, </span><span style="color:#0086b3;">51</span><span>, </span><span style="color:#0086b3;">53</span><span>, </span><span style="color:#0086b3;">55</span><span>, </span><span style="color:#0086b3;">57</span><span>, </span><span style="color:#0086b3;">59</span><span>, </span><span style="color:#0086b3;">61</span><span>, </span><span style="color:#0086b3;">63</span><span> }
</span><span>EAST_CONNECTED   :: Candidates { </span><span style="color:#0086b3;">2</span><span>,  </span><span style="color:#0086b3;">3</span><span>,  </span><span style="color:#0086b3;">6</span><span>,  </span><span style="color:#0086b3;">7</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">15</span><span>, </span><span style="color:#0086b3;">18</span><span>, </span><span style="color:#0086b3;">19</span><span>, </span><span style="color:#0086b3;">22</span><span>, </span><span style="color:#0086b3;">23</span><span>, </span><span style="color:#0086b3;">26</span><span>, </span><span style="color:#0086b3;">27</span><span>, </span><span style="color:#0086b3;">30</span><span>, </span><span style="color:#0086b3;">31</span><span>, </span><span style="color:#0086b3;">34</span><span>, </span><span style="color:#0086b3;">35</span><span>, </span><span style="color:#0086b3;">38</span><span>, </span><span style="color:#0086b3;">39</span><span>, </span><span style="color:#0086b3;">42</span><span>, </span><span style="color:#0086b3;">43</span><span>, </span><span style="color:#0086b3;">46</span><span>, </span><span style="color:#0086b3;">47</span><span>, </span><span style="color:#0086b3;">50</span><span>, </span><span style="color:#0086b3;">51</span><span>, </span><span style="color:#0086b3;">54</span><span>, </span><span style="color:#0086b3;">55</span><span>, </span><span style="color:#0086b3;">58</span><span>, </span><span style="color:#0086b3;">59</span><span>, </span><span style="color:#0086b3;">62</span><span>, </span><span style="color:#0086b3;">63</span><span> }
</span><span>SOUTH_CONNECTED  :: Candidates { </span><span style="color:#0086b3;">4</span><span>,  </span><span style="color:#0086b3;">5</span><span>,  </span><span style="color:#0086b3;">6</span><span>,  </span><span style="color:#0086b3;">7</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">15</span><span>, </span><span style="color:#0086b3;">20</span><span>, </span><span style="color:#0086b3;">21</span><span>, </span><span style="color:#0086b3;">22</span><span>, </span><span style="color:#0086b3;">23</span><span>, </span><span style="color:#0086b3;">28</span><span>, </span><span style="color:#0086b3;">29</span><span>, </span><span style="color:#0086b3;">30</span><span>, </span><span style="color:#0086b3;">31</span><span>, </span><span style="color:#0086b3;">36</span><span>, </span><span style="color:#0086b3;">37</span><span>, </span><span style="color:#0086b3;">38</span><span>, </span><span style="color:#0086b3;">39</span><span>, </span><span style="color:#0086b3;">44</span><span>, </span><span style="color:#0086b3;">45</span><span>, </span><span style="color:#0086b3;">46</span><span>, </span><span style="color:#0086b3;">47</span><span>, </span><span style="color:#0086b3;">52</span><span>, </span><span style="color:#0086b3;">53</span><span>, </span><span style="color:#0086b3;">54</span><span>, </span><span style="color:#0086b3;">55</span><span>, </span><span style="color:#0086b3;">60</span><span>, </span><span style="color:#0086b3;">61</span><span>, </span><span style="color:#0086b3;">62</span><span>, </span><span style="color:#0086b3;">63</span><span> }
</span><span>WEST_CONNECTED   :: Candidates { </span><span style="color:#0086b3;">8</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">15</span><span>, </span><span style="color:#0086b3;">24</span><span>, </span><span style="color:#0086b3;">25</span><span>, </span><span style="color:#0086b3;">26</span><span>, </span><span style="color:#0086b3;">27</span><span>, </span><span style="color:#0086b3;">28</span><span>, </span><span style="color:#0086b3;">29</span><span>, </span><span style="color:#0086b3;">30</span><span>, </span><span style="color:#0086b3;">31</span><span>, </span><span style="color:#0086b3;">40</span><span>, </span><span style="color:#0086b3;">41</span><span>, </span><span style="color:#0086b3;">42</span><span>, </span><span style="color:#0086b3;">43</span><span>, </span><span style="color:#0086b3;">44</span><span>, </span><span style="color:#0086b3;">45</span><span>, </span><span style="color:#0086b3;">46</span><span>, </span><span style="color:#0086b3;">47</span><span>, </span><span style="color:#0086b3;">56</span><span>, </span><span style="color:#0086b3;">57</span><span>, </span><span style="color:#0086b3;">58</span><span>, </span><span style="color:#0086b3;">59</span><span>, </span><span style="color:#0086b3;">60</span><span>, </span><span style="color:#0086b3;">61</span><span>, </span><span style="color:#0086b3;">62</span><span>, </span><span style="color:#0086b3;">63</span><span> }
</span><span>TOP_CONNECTED    :: Candidates {</span><span style="color:#0086b3;">16</span><span>, </span><span style="color:#0086b3;">17</span><span>, </span><span style="color:#0086b3;">18</span><span>, </span><span style="color:#0086b3;">19</span><span>, </span><span style="color:#0086b3;">20</span><span>, </span><span style="color:#0086b3;">21</span><span>, </span><span style="color:#0086b3;">22</span><span>, </span><span style="color:#0086b3;">23</span><span>, </span><span style="color:#0086b3;">24</span><span>, </span><span style="color:#0086b3;">25</span><span>, </span><span style="color:#0086b3;">26</span><span>, </span><span style="color:#0086b3;">27</span><span>, </span><span style="color:#0086b3;">28</span><span>, </span><span style="color:#0086b3;">29</span><span>, </span><span style="color:#0086b3;">30</span><span>, </span><span style="color:#0086b3;">31</span><span>, </span><span style="color:#0086b3;">48</span><span>, </span><span style="color:#0086b3;">49</span><span>, </span><span style="color:#0086b3;">50</span><span>, </span><span style="color:#0086b3;">51</span><span>, </span><span style="color:#0086b3;">52</span><span>, </span><span style="color:#0086b3;">53</span><span>, </span><span style="color:#0086b3;">54</span><span>, </span><span style="color:#0086b3;">55</span><span>, </span><span style="color:#0086b3;">56</span><span>, </span><span style="color:#0086b3;">57</span><span>, </span><span style="color:#0086b3;">58</span><span>, </span><span style="color:#0086b3;">59</span><span>, </span><span style="color:#0086b3;">60</span><span>, </span><span style="color:#0086b3;">61</span><span>, </span><span style="color:#0086b3;">62</span><span>, </span><span style="color:#0086b3;">63</span><span> }
</span><span>BOTTOM_CONNECTED :: Candidates {</span><span style="color:#0086b3;">32</span><span>, </span><span style="color:#0086b3;">33</span><span>, </span><span style="color:#0086b3;">34</span><span>, </span><span style="color:#0086b3;">35</span><span>, </span><span style="color:#0086b3;">36</span><span>, </span><span style="color:#0086b3;">37</span><span>, </span><span style="color:#0086b3;">38</span><span>, </span><span style="color:#0086b3;">39</span><span>, </span><span style="color:#0086b3;">40</span><span>, </span><span style="color:#0086b3;">41</span><span>, </span><span style="color:#0086b3;">42</span><span>, </span><span style="color:#0086b3;">43</span><span>, </span><span style="color:#0086b3;">44</span><span>, </span><span style="color:#0086b3;">45</span><span>, </span><span style="color:#0086b3;">46</span><span>, </span><span style="color:#0086b3;">47</span><span>, </span><span style="color:#0086b3;">48</span><span>, </span><span style="color:#0086b3;">49</span><span>, </span><span style="color:#0086b3;">50</span><span>, </span><span style="color:#0086b3;">51</span><span>, </span><span style="color:#0086b3;">52</span><span>, </span><span style="color:#0086b3;">53</span><span>, </span><span style="color:#0086b3;">54</span><span>, </span><span style="color:#0086b3;">55</span><span>, </span><span style="color:#0086b3;">56</span><span>, </span><span style="color:#0086b3;">57</span><span>, </span><span style="color:#0086b3;">58</span><span>, </span><span style="color:#0086b3;">59</span><span>, </span><span style="color:#0086b3;">60</span><span>, </span><span style="color:#0086b3;">61</span><span>, </span><span style="color:#0086b3;">62</span><span>, </span><span style="color:#0086b3;">63</span><span> }
</span><span>
</span><span>NORTH_NOT_CONNECTED  :: Candidates{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">4</span><span>, </span><span style="color:#0086b3;">6</span><span>, </span><span style="color:#0086b3;">8</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">16</span><span>, </span><span style="color:#0086b3;">18</span><span>, </span><span style="color:#0086b3;">20</span><span>, </span><span style="color:#0086b3;">22</span><span>, </span><span style="color:#0086b3;">24</span><span>, </span><span style="color:#0086b3;">26</span><span>, </span><span style="color:#0086b3;">28</span><span>, </span><span style="color:#0086b3;">30</span><span>, </span><span style="color:#0086b3;">32</span><span>, </span><span style="color:#0086b3;">34</span><span>, </span><span style="color:#0086b3;">36</span><span>, </span><span style="color:#0086b3;">38</span><span>, </span><span style="color:#0086b3;">40</span><span>, </span><span style="color:#0086b3;">42</span><span>, </span><span style="color:#0086b3;">44</span><span>, </span><span style="color:#0086b3;">46</span><span>, </span><span style="color:#0086b3;">48</span><span>, </span><span style="color:#0086b3;">50</span><span>, </span><span style="color:#0086b3;">52</span><span>, </span><span style="color:#0086b3;">54</span><span>, </span><span style="color:#0086b3;">56</span><span>, </span><span style="color:#0086b3;">58</span><span>, </span><span style="color:#0086b3;">60</span><span>, </span><span style="color:#0086b3;">62</span><span> }
</span><span>EAST_NOT_CONNECTED   :: Candidates{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">4</span><span>, </span><span style="color:#0086b3;">5</span><span>, </span><span style="color:#0086b3;">8</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">16</span><span>, </span><span style="color:#0086b3;">17</span><span>, </span><span style="color:#0086b3;">20</span><span>, </span><span style="color:#0086b3;">21</span><span>, </span><span style="color:#0086b3;">24</span><span>, </span><span style="color:#0086b3;">25</span><span>, </span><span style="color:#0086b3;">28</span><span>, </span><span style="color:#0086b3;">29</span><span>, </span><span style="color:#0086b3;">32</span><span>, </span><span style="color:#0086b3;">33</span><span>, </span><span style="color:#0086b3;">36</span><span>, </span><span style="color:#0086b3;">37</span><span>, </span><span style="color:#0086b3;">40</span><span>, </span><span style="color:#0086b3;">41</span><span>, </span><span style="color:#0086b3;">44</span><span>, </span><span style="color:#0086b3;">45</span><span>, </span><span style="color:#0086b3;">48</span><span>, </span><span style="color:#0086b3;">49</span><span>, </span><span style="color:#0086b3;">52</span><span>, </span><span style="color:#0086b3;">53</span><span>, </span><span style="color:#0086b3;">56</span><span>, </span><span style="color:#0086b3;">57</span><span>, </span><span style="color:#0086b3;">60</span><span>, </span><span style="color:#0086b3;">61</span><span> }
</span><span>SOUTH_NOT_CONNECTED  :: Candidates{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span>, </span><span style="color:#0086b3;">8</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">16</span><span>, </span><span style="color:#0086b3;">17</span><span>, </span><span style="color:#0086b3;">18</span><span>, </span><span style="color:#0086b3;">19</span><span>, </span><span style="color:#0086b3;">24</span><span>, </span><span style="color:#0086b3;">25</span><span>, </span><span style="color:#0086b3;">26</span><span>, </span><span style="color:#0086b3;">27</span><span>, </span><span style="color:#0086b3;">32</span><span>, </span><span style="color:#0086b3;">33</span><span>, </span><span style="color:#0086b3;">34</span><span>, </span><span style="color:#0086b3;">35</span><span>, </span><span style="color:#0086b3;">40</span><span>, </span><span style="color:#0086b3;">41</span><span>, </span><span style="color:#0086b3;">42</span><span>, </span><span style="color:#0086b3;">43</span><span>, </span><span style="color:#0086b3;">48</span><span>, </span><span style="color:#0086b3;">49</span><span>, </span><span style="color:#0086b3;">50</span><span>, </span><span style="color:#0086b3;">51</span><span>, </span><span style="color:#0086b3;">56</span><span>, </span><span style="color:#0086b3;">57</span><span>, </span><span style="color:#0086b3;">58</span><span>, </span><span style="color:#0086b3;">59</span><span> }
</span><span>WEST_NOT_CONNECTED   :: Candidates{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span>, </span><span style="color:#0086b3;">4</span><span>,  </span><span style="color:#0086b3;">5</span><span>,  </span><span style="color:#0086b3;">6</span><span>,  </span><span style="color:#0086b3;">7</span><span>, </span><span style="color:#0086b3;">16</span><span>, </span><span style="color:#0086b3;">17</span><span>, </span><span style="color:#0086b3;">18</span><span>, </span><span style="color:#0086b3;">19</span><span>, </span><span style="color:#0086b3;">20</span><span>, </span><span style="color:#0086b3;">21</span><span>, </span><span style="color:#0086b3;">22</span><span>, </span><span style="color:#0086b3;">23</span><span>, </span><span style="color:#0086b3;">32</span><span>, </span><span style="color:#0086b3;">33</span><span>, </span><span style="color:#0086b3;">34</span><span>, </span><span style="color:#0086b3;">35</span><span>, </span><span style="color:#0086b3;">36</span><span>, </span><span style="color:#0086b3;">37</span><span>, </span><span style="color:#0086b3;">38</span><span>, </span><span style="color:#0086b3;">39</span><span>, </span><span style="color:#0086b3;">48</span><span>, </span><span style="color:#0086b3;">49</span><span>, </span><span style="color:#0086b3;">50</span><span>, </span><span style="color:#0086b3;">51</span><span>, </span><span style="color:#0086b3;">52</span><span>, </span><span style="color:#0086b3;">53</span><span>, </span><span style="color:#0086b3;">54</span><span>, </span><span style="color:#0086b3;">55</span><span> }
</span><span>TOP_NOT_CONNECTED    :: Candidates{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span>, </span><span style="color:#0086b3;">4</span><span>,  </span><span style="color:#0086b3;">5</span><span>,  </span><span style="color:#0086b3;">6</span><span>,  </span><span style="color:#0086b3;">7</span><span>,  </span><span style="color:#0086b3;">8</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">15</span><span>, </span><span style="color:#0086b3;">32</span><span>, </span><span style="color:#0086b3;">33</span><span>, </span><span style="color:#0086b3;">34</span><span>, </span><span style="color:#0086b3;">35</span><span>, </span><span style="color:#0086b3;">36</span><span>, </span><span style="color:#0086b3;">37</span><span>, </span><span style="color:#0086b3;">38</span><span>, </span><span style="color:#0086b3;">39</span><span>, </span><span style="color:#0086b3;">40</span><span>, </span><span style="color:#0086b3;">41</span><span>, </span><span style="color:#0086b3;">42</span><span>, </span><span style="color:#0086b3;">43</span><span>, </span><span style="color:#0086b3;">44</span><span>, </span><span style="color:#0086b3;">45</span><span>, </span><span style="color:#0086b3;">46</span><span>, </span><span style="color:#0086b3;">47</span><span> }
</span><span>BOTTOM_NOT_CONNECTED :: Candidates{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span>, </span><span style="color:#0086b3;">4</span><span>,  </span><span style="color:#0086b3;">5</span><span>,  </span><span style="color:#0086b3;">6</span><span>,  </span><span style="color:#0086b3;">7</span><span>,  </span><span style="color:#0086b3;">8</span><span>,  </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">15</span><span>, </span><span style="color:#0086b3;">16</span><span>, </span><span style="color:#0086b3;">17</span><span>, </span><span style="color:#0086b3;">18</span><span>, </span><span style="color:#0086b3;">19</span><span>, </span><span style="color:#0086b3;">20</span><span>, </span><span style="color:#0086b3;">21</span><span>, </span><span style="color:#0086b3;">22</span><span>, </span><span style="color:#0086b3;">23</span><span>, </span><span style="color:#0086b3;">24</span><span>, </span><span style="color:#0086b3;">25</span><span>, </span><span style="color:#0086b3;">26</span><span>, </span><span style="color:#0086b3;">27</span><span>, </span><span style="color:#0086b3;">28</span><span>, </span><span style="color:#0086b3;">29</span><span>, </span><span style="color:#0086b3;">30</span><span>, </span><span style="color:#0086b3;">31</span><span> }
</span><span>
</span><span style="font-weight:bold;color:#795da3;">tile_connections</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> (c: Cell) -&gt; (ret: Candidate_Set) {
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">switch</span><span> t </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> c {
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">case</span><span> Tile: 
</span><span>        ret[.North]  = SOUTH_CONNECTED  </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .North  </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t </span><span style="font-weight:bold;color:#a71d5d;">else</span><span> {</span><span style="color:#0086b3;">0</span><span>}
</span><span>        ret[.East]   = WEST_CONNECTED   </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .East   </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t </span><span style="font-weight:bold;color:#a71d5d;">else</span><span> {</span><span style="color:#0086b3;">0</span><span>}
</span><span>        ret[.South]  = NORTH_CONNECTED  </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .South  </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t </span><span style="font-weight:bold;color:#a71d5d;">else</span><span> {</span><span style="color:#0086b3;">0</span><span>}
</span><span>        ret[.West]   = EAST_CONNECTED   </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .West   </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t </span><span style="font-weight:bold;color:#a71d5d;">else</span><span> {</span><span style="color:#0086b3;">0</span><span>}
</span><span>        ret[.Top]    = BOTTOM_CONNECTED </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .Top    </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t </span><span style="font-weight:bold;color:#a71d5d;">else</span><span> {</span><span style="color:#0086b3;">0</span><span>}
</span><span>        ret[.Bottom] = TOP_CONNECTED    </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> .Bottom </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> t </span><span style="font-weight:bold;color:#a71d5d;">else</span><span> {</span><span style="color:#0086b3;">0</span><span>}
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">case</span><span> Air:
</span><span>        ret[.North]  = SOUTH_NOT_CONNECTED
</span><span>        ret[.East]   = WEST_NOT_CONNECTED
</span><span>        ret[.South]  = NORTH_NOT_CONNECTED
</span><span>        ret[.West]   = EAST_NOT_CONNECTED
</span><span>        ret[.Top]    = BOTTOM_NOT_CONNECTED
</span><span>        ret[.Bottom] = TOP_NOT_CONNECTED
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">case</span><span>: 
</span><span>        ret = ~{}
</span><span>    }
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return
</span><span>}
</span><span>
</span><span style="font-weight:bold;color:#795da3;">grid_propagate</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span>(grid: ^Grid) -&gt; </span><span style="font-weight:bold;color:#a71d5d;">bool</span><span> {
</span><span>    </span><span style="font-style:italic;color:#969896;">// Update candidates based on cells
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> z </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;GRID_SIZE </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;GRID_SIZE </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;GRID_SIZE {
</span><span>        cell := grid.cells[x][y][z]
</span><span>        tc := </span><span style="color:#62a35c;">tile_connections</span><span>(cell)
</span><span>
</span><span>        </span><span style="font-style:italic;color:#969896;">// North
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> y &lt; GRID_SIZE - </span><span style="color:#0086b3;">1 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x][y + </span><span style="color:#0086b3;">1</span><span>][z] &amp;= tc[.North]
</span><span>        </span><span style="font-style:italic;color:#969896;">// East
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> x &lt; GRID_SIZE - </span><span style="color:#0086b3;">1 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x + </span><span style="color:#0086b3;">1</span><span>][y][z] &amp;= tc[.East]
</span><span>        </span><span style="font-style:italic;color:#969896;">// Top
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> z &lt; GRID_SIZE - </span><span style="color:#0086b3;">1 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x][y][z + </span><span style="color:#0086b3;">1</span><span>] &amp;= tc[.Top]
</span><span>        </span><span style="font-style:italic;color:#969896;">// South
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> y &gt; </span><span style="color:#0086b3;">0 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x][y - </span><span style="color:#0086b3;">1</span><span>][z] &amp;= tc[.South]
</span><span>        </span><span style="font-style:italic;color:#969896;">// West
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> x &gt; </span><span style="color:#0086b3;">0 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x - </span><span style="color:#0086b3;">1</span><span>][y][z] &amp;= tc[.West]
</span><span>        </span><span style="font-style:italic;color:#969896;">// Bottom
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> z &gt; </span><span style="color:#0086b3;">0 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> grid.candidates[x][y][z - </span><span style="color:#0086b3;">1</span><span>] &amp;= tc[.Bottom]
</span><span>
</span><span>        </span><span style="font-style:italic;color:#969896;">// if cell is a tile, make sure it is not a candidate anywhere else.
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> tile, ok := cell.(Tile); ok {
</span><span>            cand := Candidates{ </span><span style="font-weight:bold;color:#a71d5d;">int</span><span> ( </span><span style="font-weight:bold;color:#a71d5d;">transmute</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">u8</span><span>)tile ) }
</span><span>
</span><span>            grid.candidates -= cand
</span><span>            grid.candidates[x][y][z] = cand
</span><span>        }
</span><span>    }
</span><span>
</span><span>    any_collapsed := </span><span style="color:#0086b3;">false
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// Update cells based on candidates
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> z </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;GRID_SIZE </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;GRID_SIZE </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;GRID_SIZE {
</span><span>        cand := grid.candidates[x][y][z]
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> cand == {} </span><span style="font-weight:bold;color:#a71d5d;">do return </span><span style="color:#0086b3;">false </span><span style="font-style:italic;color:#969896;">// illegal state reached
</span><span>
</span><span>        </span><span style="font-style:italic;color:#969896;">// COLLAPSE
</span><span>        </span><span style="font-style:italic;color:#969896;">// obviously only a new collapse if it isnt collapsed already
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> grid.cells[x][y][z] == </span><span style="color:#0086b3;">nil</span><span> &amp;&amp; </span><span style="color:#62a35c;">card</span><span>(cand) == </span><span style="color:#0086b3;">1 </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> id </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> cand {
</span><span>            any_collapsed = </span><span style="color:#0086b3;">true
</span><span>
</span><span>            </span><span style="font-style:italic;color:#969896;">// What did actually collapse
</span><span>            grid.cells[x][y][z] = Air{} </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> id == </span><span style="color:#0086b3;">0 </span><span style="font-weight:bold;color:#a71d5d;">else transmute</span><span>(Tile)</span><span style="font-weight:bold;color:#a71d5d;">i8</span><span>(id)
</span><span>        }
</span><span>    }
</span><span>
</span><span>    success := </span><span style="color:#0086b3;">true
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> any_collapsed </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> success = </span><span style="color:#62a35c;">grid_propagate</span><span>(grid) 
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return</span><span> success
</span><span>}
</span><span>
</span><span style="font-weight:bold;color:#795da3;">grid_init</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> (grid: ^Grid) {
</span><span>    </span><span style="font-style:italic;color:#969896;">// different grid_init from before to reuse memory
</span><span>    grid.cells = {}
</span><span>    grid.cells[MID_POINT][MID_POINT][MID_POINT] = ~Tile{}
</span><span>
</span><span>    grid.candidates = ~Candidates{} 
</span><span>
</span><span>    </span><span style="color:#62a35c;">grid_propagate</span><span>(grid)
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return 
</span><span>}
</span><span>
</span><span>
</span><span style="font-weight:bold;color:#795da3;">grid_controlled_demolition</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span>(grid: ^Grid) -&gt; </span><span style="font-weight:bold;color:#a71d5d;">bool</span><span> {
</span><span>    
</span><span>    </span><span style="font-style:italic;color:#969896;">// all the shuffling 
</span><span>    rows := [GRID_SIZE]</span><span style="font-weight:bold;color:#a71d5d;">int</span><span>{}
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> i </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;GRID_SIZE </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> rows[i] = i
</span><span>    cols := rows
</span><span>    verts := cols
</span><span>
</span><span>    rand.</span><span style="color:#62a35c;">shuffle</span><span>(rows[:])
</span><span>    rand.</span><span style="color:#62a35c;">shuffle</span><span>(cols[:])
</span><span>    rand.</span><span style="color:#62a35c;">shuffle</span><span>(verts[:])
</span><span>
</span><span>    ids := []</span><span style="font-weight:bold;color:#a71d5d;">int</span><span>{ </span><span style="color:#0086b3;">0</span><span>, </span><span style="color:#0086b3;">1</span><span>, </span><span style="color:#0086b3;">2</span><span>, </span><span style="color:#0086b3;">3</span><span>, </span><span style="color:#0086b3;">4</span><span>, </span><span style="color:#0086b3;">5</span><span>, </span><span style="color:#0086b3;">6</span><span>, </span><span style="color:#0086b3;">7</span><span>, </span><span style="color:#0086b3;">8</span><span>, </span><span style="color:#0086b3;">9</span><span>, </span><span style="color:#0086b3;">10</span><span>, </span><span style="color:#0086b3;">11</span><span>, </span><span style="color:#0086b3;">12</span><span>, </span><span style="color:#0086b3;">13</span><span>, </span><span style="color:#0086b3;">14</span><span>, </span><span style="color:#0086b3;">15</span><span>, </span><span style="color:#0086b3;">16</span><span>, </span><span style="color:#0086b3;">17</span><span>, </span><span style="color:#0086b3;">18</span><span>, </span><span style="color:#0086b3;">19</span><span>, </span><span style="color:#0086b3;">20</span><span>, </span><span style="color:#0086b3;">21</span><span>, </span><span style="color:#0086b3;">22</span><span>, </span><span style="color:#0086b3;">23</span><span>, </span><span style="color:#0086b3;">24</span><span>, </span><span style="color:#0086b3;">25</span><span>, </span><span style="color:#0086b3;">26</span><span>, </span><span style="color:#0086b3;">27</span><span>, </span><span style="color:#0086b3;">28</span><span>, </span><span style="color:#0086b3;">29</span><span>, </span><span style="color:#0086b3;">30</span><span>, </span><span style="color:#0086b3;">31</span><span>, </span><span style="color:#0086b3;">32</span><span>, </span><span style="color:#0086b3;">33</span><span>, </span><span style="color:#0086b3;">34</span><span>, </span><span style="color:#0086b3;">35</span><span>, </span><span style="color:#0086b3;">36</span><span>, </span><span style="color:#0086b3;">37</span><span>, </span><span style="color:#0086b3;">38</span><span>, </span><span style="color:#0086b3;">39</span><span>, </span><span style="color:#0086b3;">40</span><span>, </span><span style="color:#0086b3;">41</span><span>, </span><span style="color:#0086b3;">42</span><span>, </span><span style="color:#0086b3;">43</span><span>, </span><span style="color:#0086b3;">44</span><span>, </span><span style="color:#0086b3;">45</span><span>, </span><span style="color:#0086b3;">46</span><span>, </span><span style="color:#0086b3;">47</span><span>, </span><span style="color:#0086b3;">48</span><span>, </span><span style="color:#0086b3;">49</span><span>, </span><span style="color:#0086b3;">50</span><span>, </span><span style="color:#0086b3;">51</span><span>, </span><span style="color:#0086b3;">52</span><span>, </span><span style="color:#0086b3;">53</span><span>, </span><span style="color:#0086b3;">54</span><span>, </span><span style="color:#0086b3;">55</span><span>, </span><span style="color:#0086b3;">56</span><span>, </span><span style="color:#0086b3;">57</span><span>, </span><span style="color:#0086b3;">58</span><span>, </span><span style="color:#0086b3;">59</span><span>, </span><span style="color:#0086b3;">60</span><span>, </span><span style="color:#0086b3;">61</span><span>, </span><span style="color:#0086b3;">62</span><span>, </span><span style="color:#0086b3;">63</span><span> }
</span><span>    rand.</span><span style="color:#62a35c;">shuffle</span><span>(ids)
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// target collapse stored here
</span><span>    t_x, t_y, t_z: </span><span style="font-weight:bold;color:#a71d5d;">int
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// tracking the minimum
</span><span>    min_card := </span><span style="color:#62a35c;">max</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">int</span><span>)
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> z </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> verts </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> cols </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> rows {
</span><span>        c := </span><span style="color:#62a35c;">card</span><span>(grid.candidates[x][y][z])
</span><span>        (c &gt; </span><span style="color:#0086b3;">1</span><span>) </span><span style="font-weight:bold;color:#a71d5d;">or_continue </span><span style="font-style:italic;color:#969896;">// already collapsed
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> c &lt; min_card {
</span><span>            t_x = x
</span><span>            t_y = y
</span><span>            t_z = z
</span><span>            min_card = c
</span><span>        }
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> min_card == </span><span style="color:#0086b3;">2 </span><span style="font-weight:bold;color:#a71d5d;">do break </span><span style="font-style:italic;color:#969896;">// no point in looking further in this case.
</span><span>    }
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> id </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> ids </span><span style="font-weight:bold;color:#a71d5d;">do if</span><span> id </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> grid.candidates[t_x][t_y][t_z] {
</span><span>        </span><span style="font-style:italic;color:#969896;">// COLLAPSE
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> id == </span><span style="color:#0086b3;">0</span><span> {
</span><span>            grid.cells[t_x][t_y][t_z] = Air{}
</span><span>            grid.candidates[t_x][t_y][t_z] = {</span><span style="color:#0086b3;">0</span><span>}
</span><span>        } </span><span style="font-weight:bold;color:#a71d5d;">else</span><span> {
</span><span>            tile := </span><span style="font-weight:bold;color:#a71d5d;">transmute</span><span>(Tile)</span><span style="font-weight:bold;color:#a71d5d;">i8</span><span>(id)
</span><span>            cand := Candidates{ id }
</span><span>
</span><span>            grid.cells[t_x][t_y][t_z] = tile
</span><span>            grid.candidates -= cand
</span><span>            grid.candidates[t_x][t_y][t_z] = cand
</span><span>        }
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">break
</span><span>    }
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return </span><span style="color:#62a35c;">grid_propagate</span><span>(grid)
</span><span>}
</span><span>
</span><span>
</span><span style="font-weight:bold;color:#795da3;">main</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> () {
</span><span>    grid := </span><span style="color:#62a35c;">new</span><span>(Grid)
</span><span>    </span><span style="color:#62a35c;">grid_init</span><span>(grid)
</span><span>
</span><span>    outer: </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> i </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">1</span><span> ..&lt; </span><span style="color:#62a35c;">max</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">int</span><span>) {
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">for </span><span style="color:#62a35c;">grid_controlled_demolition</span><span>(grid) {
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> grid.candidates[</span><span style="color:#0086b3;">0</span><span>][</span><span style="color:#0086b3;">0</span><span>][</span><span style="color:#0086b3;">0</span><span>] == {</span><span style="color:#0086b3;">0</span><span>} </span><span style="font-weight:bold;color:#a71d5d;">do break</span><span> outer
</span><span>        }
</span><span>
</span><span>        </span><span style="color:#62a35c;">grid_init</span><span>(grid)
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> i % </span><span style="color:#0086b3;">10</span><span> == </span><span style="color:#0086b3;">0 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> fmt.</span><span style="color:#62a35c;">eprint</span><span>(</span><span style="color:#183691;">&quot;try&quot;</span><span>, i, </span><span style="color:#183691;">&quot;</span><span style="color:#0086b3;">\r</span><span style="color:#183691;">&quot;</span><span>)
</span><span>    }
</span><span>
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> z </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;GRID_SIZE </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;GRID_SIZE </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">0</span><span>..&lt;GRID_SIZE {
</span><span>        fmt.</span><span style="color:#62a35c;">println</span><span>(x, y, z, grid.candidates[x][y][z])
</span><span>    }
</span><span>
</span><span>}
</span></code></pre>
<p>Running this takes <em>forever</em>, by the way. Even when compiling it optimized for speed with <code>odin build . -o:speed</code>, the first run at the solution took more than 290,000 iterations and more than 18 minutes before I gave up on it, and decided to change allocations a bit. Doubt rised in my heart whether this halts at all, or if it has a nasty bug that is difficult to find due to, well, the long runtime. Threading will probably <em>not</em> make this faster.</p>
<p>The longest time I ran it, it went for 25,771,590 iterations and around 27 hours of usertime before I shut it off.</p>
<p>Maybe, just maybe, completely random attempts are the wrong approach. Maybe I actually need to implement proper backtracking to ensure that the same tree is not being barked multiple times.</p>
<p>I have spent a few days mulling it over, and the simplest way to implement is to have a dynamic array in <code>Grid</code> to save every state where an arbitrary (<em>not</em> random) choice was made, in addition to the <em>index</em> of the choice. And whenever reaching an illegal state, the grid is reset to the previous state, and the index is incremented. Should the index reach a certain value (10 or whatever), then the last state is discarded and the index is incremented on the one before it.</p>
<h3 id="grid-enhancements">Grid Enhancements</h3>
<p>So, first things first, here is the new <code>Grid</code> struct, with a few type aliases to lighten the mood.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span>Cell_Grid      :: [GRID_SIZE][GRID_SIZE][GRID_SIZE]Cell
</span><span>Candidate_Grid :: [GRID_SIZE][GRID_SIZE][GRID_SIZE]Candidates
</span><span>
</span><span>Demolition_Point :: </span><span style="font-weight:bold;color:#a71d5d;">struct</span><span> {
</span><span>    grid: Cell_Grid,
</span><span>    idx:  </span><span style="font-weight:bold;color:#a71d5d;">int</span><span>,
</span><span>}
</span><span>
</span><span>Grid :: </span><span style="font-weight:bold;color:#a71d5d;">struct</span><span> {
</span><span>    cells:       Cell_Grid,
</span><span>    candidates:  Candidate_Grid,
</span><span>    demolitions: [</span><span style="font-weight:bold;color:#a71d5d;">dynamic</span><span>]Demolition_Point
</span><span>}
</span></code></pre>
<p>Having the dynamic array there should, in theory, be safe. The Grid is initialized once, And whenever the controlled demolition fails, the index of the last item in <code>demolitions</code> is updated. <em>Or</em>, if it exceeds some threshold (preferably exhausting all the candidates in a cell), the last entry is removed and the second to last entry increments its index instead.</p>
<p>Now, for the procedures used, <code>grid_propagate</code> should probably be the same. While <code>grid_init</code> and <code>grid_controlled_demolition</code> should perhaps be overhauled.</p>
<p>A potential enhancement, to avoid the algorithm being stuck on the same start every time, is to reuse the shuffling above in initialization. Shuffling the IDs for every new <code>Demolition_Point</code> would be enough, unlike shuffling rows and columns. the reason for that is, if the program exhausted every candidate from a cell, then there is no point in trying other cells from the same state. This is what that would look like.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span>Demolition_Point :: </span><span style="font-weight:bold;color:#a71d5d;">struct</span><span> {
</span><span>    grid:        Cell_Grid,
</span><span>    idx:         </span><span style="font-weight:bold;color:#a71d5d;">int</span><span>,
</span><span>    ids_shuffle: [</span><span style="color:#0086b3;">64</span><span>]</span><span style="font-weight:bold;color:#a71d5d;">int
</span><span>}
</span><span>
</span><span style="font-style:italic;color:#969896;">// ...
</span><span>
</span><span style="font-weight:bold;color:#795da3;">grid_init</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> (grid: ^Grid) {
</span><span>    grid.cells[MID_POINT][MID_POINT][MID_POINT] = ~Tile{}
</span><span>    grid.candidates = ~Candidates{} 
</span><span>
</span><span>    </span><span style="color:#62a35c;">grid_propagate</span><span>(grid)
</span><span>
</span><span>    start_point := Demolition_Point {
</span><span>        grid = grid.cells,
</span><span>        idx = </span><span style="color:#0086b3;">0</span><span>,
</span><span>        ids_shuffle = IDS, </span><span style="font-style:italic;color:#969896;">// IDS is numbers from 0 to 63.
</span><span>    }
</span><span>
</span><span>    rand.</span><span style="color:#62a35c;">shuffle</span><span>(start_point.ids_shuffle[:])
</span><span>
</span><span>    </span><span style="color:#62a35c;">append</span><span>(&amp;grid.demolitions, start_point)
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return 
</span><span>}
</span></code></pre>
<h3 id="demolition-revision">Demolition Revision</h3>
<p>Previously, <code>grid_init</code> was used to reset the state after every failed attempt. This time a different procedure is needed, which may be called <code>grid_backtrack</code>, or <code>increment</code>, who knows. This proc would only be called for a <em>failed</em> controlled demolition. Demolition can fail for two reasons: either the candidate chosen forced an illegal state, or all candidates from the lowest cell were exhausted. This call for an <code>enum</code>! <code>grid_controlled_demolition</code> can return this enum and based on whivh <code>grid_backtrack</code> decides what to do.</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span>Demolition_Result :: </span><span style="font-weight:bold;color:#a71d5d;">enum</span><span> { Success, Exhausted_Candidates, Illegal_State }
</span></code></pre>
<p>And this would be the new version of <code>grid_controlled_demolition</code>, with less shuffling and small changes:</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">grid_controlled_demolition</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span>(grid: ^Grid) -&gt; Demolition_Result {
</span><span>
</span><span>    t_x, t_y, t_z: </span><span style="font-weight:bold;color:#a71d5d;">int
</span><span>    min_card := </span><span style="color:#62a35c;">max</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">int</span><span>)
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> z </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> RANKS </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> y </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> RANKS </span><span style="font-weight:bold;color:#a71d5d;">do for</span><span> x </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> RANKS { </span><span style="font-style:italic;color:#969896;">// RANKS is numbers 0 to 30
</span><span>        c := </span><span style="color:#62a35c;">card</span><span>(grid.candidates[x][y][z])
</span><span>        (c &gt; </span><span style="color:#0086b3;">1</span><span>) </span><span style="font-weight:bold;color:#a71d5d;">or_continue 
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> c &lt; min_card {
</span><span>            t_x = x
</span><span>            t_y = y
</span><span>            t_z = z
</span><span>            min_card = c
</span><span>        }
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> min_card == </span><span style="color:#0086b3;">2 </span><span style="font-weight:bold;color:#a71d5d;">do break 
</span><span>    }
</span><span>
</span><span>    demo_pt := grid.demolitions[</span><span style="color:#62a35c;">len</span><span>(grid.demolitions) - </span><span style="color:#0086b3;">1</span><span>] </span><span style="font-style:italic;color:#969896;">// should never be empty
</span><span>
</span><span>    counter := </span><span style="color:#0086b3;">0
</span><span>    exhausted := </span><span style="color:#0086b3;">true 
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> id </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> demo_pt.ids_shuffle </span><span style="font-weight:bold;color:#a71d5d;">do if</span><span> id </span><span style="font-weight:bold;color:#a71d5d;">in</span><span> grid.candidates[t_x][t_y][t_z] {
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> counter &lt; demo_pt.idx {
</span><span>            </span><span style="font-style:italic;color:#969896;">// Skip till idx is reached.
</span><span>            counter += </span><span style="color:#0086b3;">1
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">continue
</span><span>        }
</span><span>
</span><span>        </span><span style="font-style:italic;color:#969896;">// COLLAPSE
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> id == </span><span style="color:#0086b3;">0</span><span> {
</span><span>            grid.cells[t_x][t_y][t_z] = Air{}
</span><span>            grid.candidates[t_x][t_y][t_z] = {</span><span style="color:#0086b3;">0</span><span>}
</span><span>        } </span><span style="font-weight:bold;color:#a71d5d;">else</span><span> {
</span><span>            tile := </span><span style="font-weight:bold;color:#a71d5d;">transmute</span><span>(Tile)</span><span style="font-weight:bold;color:#a71d5d;">i8</span><span>(id)
</span><span>            cand := Candidates{ id }
</span><span>
</span><span>            grid.cells[t_x][t_y][t_z] = tile
</span><span>            grid.candidates -= cand
</span><span>            grid.candidates[t_x][t_y][t_z] = cand
</span><span>        }
</span><span>
</span><span>        exhausted = </span><span style="color:#0086b3;">false
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">break
</span><span>    }
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// Here is the interesting part.
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> exhausted </span><span style="font-weight:bold;color:#a71d5d;">do return</span><span> .Exhausted_Candidates
</span><span>    
</span><span>    ok := </span><span style="color:#62a35c;">grid_propagate</span><span>(grid)
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return</span><span> .Success </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> ok </span><span style="font-weight:bold;color:#a71d5d;">else</span><span> .Illegal_State
</span><span>}
</span></code></pre>
<h3 id="the-main-loop">The Main Loop</h3>
<p>Before figuring out how the supposed <code>grid_backtrack</code> looks like, it might help to construct how the loop looks. With a side of Odin flavoured golf:</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">main</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> () {
</span><span>    grid := </span><span style="color:#62a35c;">new</span><span>(Grid)
</span><span>    </span><span style="color:#62a35c;">grid_init</span><span>(grid)
</span><span>
</span><span>    </span><span style="font-style:italic;color:#969896;">// inner tag is only for readability
</span><span>    outer: </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> i </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#0086b3;">1</span><span> ..&lt; </span><span style="color:#62a35c;">max</span><span>(</span><span style="font-weight:bold;color:#a71d5d;">int</span><span>) </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> inner: </span><span style="font-weight:bold;color:#a71d5d;">for</span><span> {
</span><span>        result := </span><span style="color:#62a35c;">grid_controlled_demolition</span><span>(grid)
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">switch</span><span> result {
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">case</span><span> .Success:
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> grid.candidates[</span><span style="color:#0086b3;">0</span><span>][</span><span style="color:#0086b3;">0</span><span>][</span><span style="color:#0086b3;">0</span><span>] == {</span><span style="color:#0086b3;">0</span><span>} </span><span style="font-weight:bold;color:#a71d5d;">do break</span><span> outer
</span><span>
</span><span>            demo_pt := Demolition_Point {
</span><span>                grid = grid.cells,
</span><span>                idx = </span><span style="color:#0086b3;">0</span><span>,
</span><span>                ids_shuffle = IDS
</span><span>            }
</span><span>            rand.</span><span style="color:#62a35c;">shuffle</span><span>(demo_pt.ids_shuffle[:])
</span><span>
</span><span>            </span><span style="color:#62a35c;">append</span><span>(&amp;grid.demolitions, demo_pt)
</span><span>
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">case</span><span> .Exhausted_Candidates, .Illegal_State:
</span><span>            </span><span style="color:#62a35c;">grid_backtrack</span><span>(grid, result)
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if</span><span> i % </span><span style="color:#0086b3;">10</span><span> == </span><span style="color:#0086b3;">0 </span><span style="font-weight:bold;color:#a71d5d;">do</span><span> fmt.</span><span style="color:#62a35c;">eprint</span><span>(</span><span style="color:#183691;">&quot;try&quot;</span><span>, i, </span><span style="color:#183691;">&quot;</span><span style="color:#0086b3;">\r</span><span style="color:#183691;">&quot;</span><span>) </span><span style="font-style:italic;color:#969896;">// debug land
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">break</span><span> inner
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#62a35c;">grid_draw</span><span>(grid) </span><span style="font-style:italic;color:#969896;">// &lt;-- later
</span><span>}
</span></code></pre>
<h3 id="the-step-back">The Step Back</h3>
<p>For backtracking, what is done depends on the error returned. If it is an illegal state, just increment the index and restart. If it is exhausted candidates, remove the last state, then increment the index of the previous one. This is the initial idea:</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span style="font-weight:bold;color:#795da3;">grid_backtrack</span><span> :: </span><span style="font-weight:bold;color:#a71d5d;">proc</span><span> (grid: ^Grid, result: Result) {
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">switch</span><span> result {
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">case</span><span> .Success: 
</span><span>        </span><span style="color:#62a35c;">unreachable</span><span>()
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">case</span><span> .Exhausted_Candidates:
</span><span>        </span><span style="color:#62a35c;">pop</span><span>(&amp;grid.demolitions)
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">case</span><span> .Illegal_State:
</span><span>        </span><span style="font-style:italic;color:#969896;">// nothing
</span><span>    }
</span><span>
</span><span>    last := slice.</span><span style="color:#62a35c;">last_ptr</span><span>(grid.demolitions[:])
</span><span>    last.idx += </span><span style="color:#0086b3;">1
</span><span>
</span><span>    grid.cells = last.grid
</span><span>    </span><span style="color:#62a35c;">grid_propagate</span><span>(grid)
</span><span>}
</span></code></pre>
<p>Unfortunately, putting all these together and running it, quickly hits a segfault. I could not figure out why at first, but then peppering a few <code>fmt.eprint</code> around, I realized that the state of <code>grid.candidates</code> wasn't being reset properly between iterations. So any changes made to it in <code>grid_propagate</code> would persist.</p>
<p>I fixed that by adding a line just before the call to <code>grid_propagate</code> in <code>grid_backtrack</code>:</p>
<pre data-lang="odin" style="background-color:#ffffff;color:#323232;" class="language-odin "><code class="language-odin" data-lang="odin"><span>    grid.cells = last.grid
</span><span>    grid.candidates = ~Candidates{} </span><span style="font-style:italic;color:#969896;">// &lt;-- this one
</span><span>
</span><span>    </span><span style="color:#62a35c;">grid_propagate</span><span>(grid)
</span></code></pre>
<p>Ok, not segfaulting. Good news. The peppered around <code>fmt.eprint</code>s show behaviour that make sense.</p>
<p>Also, similarly to the reset the world behaviour experimented with at first, this is still taking a long time to run, with no idea whether it halts or not. Building it with <code>-o:speed</code> as done before, and running it overnight might give the needed answer.</p>
<h3 id="out-of-memory">Out of Memory</h3>
<p>I woke up to this:</p>
<p><img src="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/out_of_memory.png" alt="Uses 30GB of memory" /></p>
<p>I spent a few days trying different things out and seeing what is causing the ballooning in memory. For whatever reason, the program seemed to be allocating a lot more memory than I expected, and the dynamic array of <code>demolitions</code> is ballooning uncontrollably. In theory, there would be 31x31x31 successful demolitions at most. I tested this by using Odin's core library's <code>Small_Array</code>, which is a "dynamic" array with a fixed capacity, giving it 31x31x31 size, and it quickly filled up and panicked as it attempted appending to a full array. This indicates, to me, a logic error somewhere.</p>
<p>I tried different variations of the main loop, including inlining <code>grid_backtrack</code>. I removed the ID shuffling per <code>Demolition_Point</code>. I made the <code>Grid</code> smaller. I tried not shuffling <code>IDS</code>. All of them either ran into the same memory issue or just .. kept running.<sup class="footnote-reference" id="fr-exception-1"><a href="#fn-exception">9</a></sup> I am at a complete loss of what the issue might be. Clearly this approach to backtracking is not working. I am honestly out of spoons thinking about this.</p>
<hr />
<h2 id="giving-up-and-lessons-learned">Giving Up and Lessons Learned</h2>
<p>To be honest, it has been almost two months since I started this article, and I am tired of iterating on the problem. <a href="https://asibahi.github.io/thoughts/the-hanging-gardens-problem/#frankenstein-s-monster">Frankenstein's Monster</a> works in theory, given infintie time, and for now this is enough for me. Maybe one day I will go back to figuring how to get to a slution in human time.</p>
<p>The part I enjoyed the most was iterating on the graphics with <code>raylib</code>. The library is really easy to use, if not as flexible as I hoped. Maybe for the next project I will do some sort of game, or just use it as generative art.</p>
<p>I should watch more Coding Train videos.</p>
<footer class="footnotes">
<ol class="footnotes-list">
<li id="fn-1">
<p>The original tile set inspired a number of games by Christian Freeling. One of them is Dominions, for which I wrote <a href="https://asibahi.github.io/thoughts/the-garden-of-odin/">an implementation in Odin</a>. <a href="#fr-1-1">↩</a></p>
</li>
<li id="fn-2">
<p>This is what Freeling calls a "Transcendental solution". <a href="#fr-2-1">↩</a></p>
</li>
<li id="fn-3">
<p>This might sound heretical in Sudoku, but in well constructed Sudoku puzzles there is always at least one cell with exactly one candidate in any given puzzle state thought solving. If ever there are not any, either it is not a well constructed puzzle, or the solver is unaware of the Ring of Phistomefel. <a href="#fr-3-1">↩</a></p>
</li>
<li id="fn-edges">
<p>Nor does it into account the edges of the Grid (where only Red faces may, well, face.) However, the edges of the Grid are unlikely to be reached, so I will ignore that for now. <a href="#fr-edges-1">↩</a></p>
</li>
<li id="fn-metaphor">
<p>Yes I am totally mixing metaphors right now. Way beyond Quantum Mechanics and well into AEC. Roll with it. <a href="#fr-metaphor-1">↩</a></p>
</li>
<li id="fn-symmetric">
<p>More interesting variations can include a search for only symmetrical solutions. This would require additional, more complex constraints in candidate placements. Nothing that cannot be dome but a whole lot more code. <a href="#fr-symmetric-1">↩</a></p>
</li>
<li id="fn-iterating">
<p>Iterating on this would be a lot more pleasant if generating the solution was faster. Maybe I should not have skipped that distributing work across threads step. <a href="#fr-iterating-1">↩</a></p>
</li>
<li id="fn-warning">
<p>"<code>Declaration of 'grid' may cause a stack overflow due to its type 'Grid' having a size of 297912 bytes</code>" <a href="#fr-warning-1">↩</a></p>
</li>
<li id="fn-exception">
<p>There was one exception where it terminated in 9 seconds. I realized that <code>0</code> being the first ID it always tests makes it fill everything with <code>Air</code> tiles. <a href="#fr-exception-1">↩</a></p>
</li>
</ol>
</footer>
</main>

			
			
				<footer>
					<small>
						
							<a class="mylink" href="mailto:a.sibahi@gmail.com" rel="me">Mail</a>
						
							<a class="mylink" href="https:&#x2F;&#x2F;x.com&#x2F;@asibahi" rel="me">Twitter</a>
						
							<a class="mylink" href="https:&#x2F;&#x2F;typo.social&#x2F;@asibahi" rel="me">typo.social</a>
						
							<a class="mylink" href="https:&#x2F;&#x2F;github.com&#x2F;asibahi" rel="me">GitHub</a>
						
							<a class="mylink" href="https:&#x2F;&#x2F;sr.ht&#x2F;~asibahi&#x2F;" rel="me">SourceHut</a>
						
						
							<a class="mylink" href="https:&#x2F;&#x2F;asibahi.github.io&#x2F;about&#x2F;">Cat</a>
						
					</small>
				</footer>
			
		</div>
	</body>
</html>
